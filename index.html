<!DOCTYPE html>
<!-- saved from url=(0038)https://riolite55.github.io/index.html -->
<html lang="en" style="--vh: 9.32px;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HRSD AI Executive Office</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Include Chart.js from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-blue: #00A99D;
            --dark-teal: #004F58;
            --text-light: #e0e0e0;
            --text-dark: #ffffff;
            --border-color: rgba(255, 255, 255, 0.2);
            --container-bg: rgba(0, 30, 60, 0.5);
            --container-bg-light: rgba(255, 255, 255, 0.08);
            --vh: 1vh;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        * {
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--dark-teal);
            color: var(--text-light);
            background-image: url('https://images.unsplash.com/photo-1550745165-9bc0b252726a?q=80&w=1920&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            min-height: calc(var(--vh, 1vh) * 100);
        }

        body::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle at 50% 50%, rgba(0, 79, 88, 0.1) 0%, rgba(0, 79, 88, 0.8) 70%, #00282d 100%);
            z-index: -1;
        }

        .header, .nav-tabs-container {
            background-color: transparent;
            backdrop-filter: blur(15px);
            position: sticky;
            z-index: 900;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 40px;
            border-bottom: 1px solid var(--border-color);
            top: 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .header-left, .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-left img.hrsd-logo {
            height: 50px;
            width: auto;
        }
        .header-left span { font-weight: 500; font-size: 1.2rem; }

        .header-right .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-right .user-profile img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--primary-blue);
        }

        .header-right .user-profile span { font-weight: 500; }
        .header-right button {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.1rem;
            cursor: pointer;
            padding: 5px;
            transition: color 0.2s;
        }
        .header-right button:hover {
            color: var(--primary-blue);
        }

        .mobile-menu-btn { display: none; }

        .nav-tabs-container {
            display: flex;
            justify-content: center;
            padding: 5px 0;
            border-bottom: 1px solid var(--border-color);
            top: 83px; /* Adjusted based on typical header height */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .nav-tabs {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-tabs button {
            background: none;
            border: none;
            padding: 10px 20px;
            font-size: 0.9rem;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            border-radius: 25px;
            border: 1px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .nav-tabs button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 169, 157, 0.2), transparent);
            transition: left 0.5s;
        }

        .nav-tabs button:hover::before {
            left: 100%;
        }

        .nav-tabs button.active {
            color: var(--text-dark);
            background: linear-gradient(135deg, var(--primary-blue), #008a7e);
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(0, 169, 157, 0.4);
            border-color: rgba(0, 169, 157, 0.3);
        }

        .nav-tabs button:hover:not(.active) {
            background-color: var(--container-bg-light);
            border-color: var(--border-color);
            transform: translateY(-2px);
        }
        .main-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 0;
        }

        .page-content {
            display: none;
            flex-grow: 1;
            padding: 20px 40px;
            gap: 20px;
            min-height: 0;
            overflow: hidden;
        }
        .page-content.active {
            display: flex;
        }

        .chat-section-container {
            flex: 2;
            display: flex;
            gap: 20px;
            background: var(--container-bg);
            border-radius: 20px;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(20px);
            padding: 20px;
            min-width: 0;
            min-height: 0;
            max-height: calc(100vh - 220px);
            box-shadow: var(--shadow-lg);
        }

        .persona-display {
            flex: 0 0 280px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: var(--container-bg);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(20px);
            min-height: 0;
            max-height: calc(100vh - 220px);
        }

        /* Removed old single persona image styles - now using multi-agent selection */
        
        .multi-agent-header {
            text-align: left;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 6px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        
        /* Multi-Agent Selection Styles */
        .multi-agent-header {
            text-align: left;
        }
        
        .multi-agent-header h3 {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Mode Toggle */
        /* Mode Toggle */
        .mode-toggle-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 12px;
            background: rgba(0, 169, 157, 0.1);
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
        }
        
        .mode-toggle-label {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-light);
            opacity: 0.7;
        }
        
        .mode-toggle-label.active {
            opacity: 1;
            color: var(--primary-blue);
            font-weight: 600;
        }
        
        .mode-toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
        }
        
        .mode-toggle-switch input {
            display: none;
        }
        
        .mode-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 34px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .mode-toggle-slider:before {
            position: absolute;
            content: "1";
            height: 22px;
            width: 22px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--dark-teal);
        }
        
        .mode-toggle-switch input:checked + .mode-toggle-slider {
            background: linear-gradient(135deg, var(--primary-blue), #008a7e);
            border-color: var(--primary-blue);
        }
        
        .mode-toggle-switch input:checked + .mode-toggle-slider:before {
            transform: translateX(30px);
            content: "✓";
            font-size: 0.8rem;
        }
        
        /* Single Agent Mode Styles */
        .single-agent-display {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .single-agent-display.active {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .single-agent-avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto;
            border: 4px solid var(--primary-blue);
            box-shadow: 0 8px 30px rgba(0, 169, 157, 0.4);
            object-fit: cover;
            transition: all 0.3s;
        }
        
        .single-agent-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 40px rgba(0, 169, 157, 0.6);
        }
        
        .single-agent-info {
            padding: 10px;
        }
        
        .single-agent-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 5px;
        }
        
        .single-agent-title {
            font-size: 0.9rem;
            color: var(--primary-blue);
            font-weight: 500;
            margin-bottom: 15px;
        }
        
        .single-agent-description {
            font-size: 0.85rem;
            line-height: 1.6;
            opacity: 0.9;
            padding: 0 10px;
        }
        
        /* Agent Selector Button in Chat */
        #agentSelectorBtn {
            background: linear-gradient(135deg, rgba(0, 169, 157, 0.15), rgba(0, 169, 157, 0.25));
            border: 2px solid var(--primary-blue);
            color: var(--text-light);
            padding: 6px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: none;
            align-items: center;
            justify-content: center;
            gap: 4px;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(0, 169, 157, 0.3);
            position: relative;
            width: 70px !important;
            min-width: 70px;
            flex-shrink: 0;
        }
        
        #agentSelectorBtn.active {
            display: flex;
        }
        
        #agentSelectorBtn:hover {
            background: linear-gradient(135deg, rgba(0, 169, 157, 0.25), rgba(0, 169, 157, 0.35));
            border-color: #00bfae;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 169, 157, 0.4);
        }
        
        #agentSelectorBtn:active {
            transform: translateY(0);
        }
        
        #agentSelectorBtn img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid var(--primary-blue);
            box-shadow: 0 2px 6px rgba(0, 169, 157, 0.3);
        }
        
        #agentSelectorBtn span {
            display: none; /* Hide name, only show avatar */
        }
        
        #agentSelectorBtn i {
            color: var(--primary-blue);
            font-size: 0.75rem;
            opacity: 0.9;
        }
        
        /* Agent Selection List - hide in single mode */
        .multi-agent-content {
            display: block;
        }
        
        .multi-agent-content.hidden {
            display: none;
        }
        
        .agent-selection-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
            min-height: 0;
            overflow-y: auto;
            padding: 5px 0;
        }
        
        .agent-selection-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .agent-selection-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .agent-selection-list::-webkit-scrollbar-thumb {
            background: var(--primary-blue);
            border-radius: 10px;
        }
        
        .agent-select-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: var(--container-bg-light);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .agent-select-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 169, 157, 0.1), rgba(0, 169, 157, 0.2));
            border-radius: 12px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }
        
        .agent-select-item:hover::before {
            opacity: 1;
        }
        
        .agent-select-item:hover {
            border-color: rgba(0, 169, 157, 0.3);
            transform: translateX(3px);
        }
        
        .agent-select-item.selected {
            background: linear-gradient(135deg, rgba(0, 169, 157, 0.2), rgba(0, 169, 157, 0.3));
            border-color: var(--primary-blue);
            box-shadow: 0 0 20px rgba(0, 169, 157, 0.4), inset 0 0 20px rgba(0, 169, 157, 0.1);
            animation: agentSelected 0.4s ease;
        }
        
        .agent-select-item.selected .agent-mini-avatar {
            border-color: var(--primary-blue);
            box-shadow: 0 0 15px rgba(0, 169, 157, 0.5);
        }
        
        .agent-select-item.selected .agent-select-name {
            color: var(--primary-blue);
        }
        
        @keyframes agentSelected {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        
        .agent-checkbox {
            display: none; /* Hide the actual checkbox */
        }
        
        /* Toggle Switch */
        .agent-toggle {
            position: relative;
            width: 50px;
            height: 26px;
            margin-right: 12px;
            flex-shrink: 0;
            cursor: pointer;
        }
        
        .agent-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 34px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .agent-toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .agent-checkbox:checked + .agent-toggle .agent-toggle-slider {
            background: linear-gradient(135deg, var(--primary-blue), #008a7e);
            border-color: var(--primary-blue);
            box-shadow: 0 0 10px rgba(0, 169, 157, 0.5), inset 0 1px 3px rgba(255, 255, 255, 0.3);
        }
        
        .agent-checkbox:checked + .agent-toggle .agent-toggle-slider:before {
            transform: translateX(24px);
            box-shadow: 0 2px 8px rgba(0, 169, 157, 0.4);
        }
        
        .agent-toggle-slider:hover {
            background-color: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .agent-checkbox:checked + .agent-toggle .agent-toggle-slider:hover {
            background: linear-gradient(135deg, #00bfae, #00a99d);
            box-shadow: 0 0 15px rgba(0, 169, 157, 0.7), inset 0 1px 3px rgba(255, 255, 255, 0.3);
        }
        
        /* Active state when clicking */
        .agent-toggle:active .agent-toggle-slider:before {
            width: 22px;
        }
        
        .agent-mini-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid var(--border-color);
            object-fit: cover;
            flex-shrink: 0;
        }
        
        .agent-select-info {
            flex: 1;
            text-align: left;
            min-width: 0;
        }
        
        .agent-select-name {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.9rem;
            margin-bottom: 2px;
        }
        
        .agent-select-title {
            font-size: 0.72rem;
            opacity: 0.7;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .multi-agent-badge {
            display: inline-block;
            background: var(--primary-blue);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 6px;
        }
        
        .agent-name-tag {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--primary-blue);
            margin-bottom: 5px;
            display: block;
        }
        
        .agent-discussion-indicator {
            background: linear-gradient(90deg, rgba(0, 169, 157, 0.2), rgba(0, 169, 157, 0.05));
            border-left: 3px solid var(--primary-blue);
            padding: 10px 15px;
            margin: 12px 0;
            border-radius: 8px;
            font-style: italic;
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .quick-actions h4 {
            margin: 0 0 8px 0;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            opacity: 0.7;
            font-weight: 600;
            text-align: center;
            color: var(--text-light);
        }

        .quick-action-btn {
            background: var(--container-bg-light);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            padding: 10px 12px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            text-align: left;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
        }

        .quick-action-btn:hover {
            background: linear-gradient(135deg, var(--primary-blue), #008a7e);
            color: var(--text-dark);
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0, 169, 157, 0.4);
            border-color: transparent;
        }

        .quick-action-btn i {
            font-size: 1rem;
            width: 18px;
            text-align: center;
            flex-shrink: 0;
            opacity: 0.9;
        }

        .quick-action-btn:hover i {
            opacity: 1;
        }

        .quick-action-btn span {
            flex: 1;
        }

        .chat-interaction-area { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            min-width: 0; 
            min-height: 0;
            overflow: hidden;
        }
        .chat-messages { 
            flex: 1; 
            overflow-y: auto; 
            overflow-x: hidden;
            padding-right: 10px; 
            min-height: 0;
        }
        
        /* Custom scrollbar styling for chat messages */
        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }
        
        .chat-messages::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background: var(--primary-blue);
            border-radius: 10px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #00bfae;
        }

        .message-bubble {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: flex-start;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-bubble.user { justify-content: flex-end; }
        .message-bubble .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            border: 2px solid var(--border-color);
        }
        .message-bubble .content {
            padding: 14px 20px;
            border-radius: 18px;
            max-width: 80%;
            font-size: 0.95rem;
            line-height: 1.7;
            border: 1px solid transparent;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
        }
        .message-bubble.user .content {
            background: linear-gradient(135deg, var(--primary-blue), #008a7e);
            color: #fff;
            border-bottom-right-radius: 5px;
        }
        .message-bubble.agent .content {
            background-color: rgba(0, 0, 0, 0.25);
            border-color: var(--border-color);
            color: var(--text-light);
            border-bottom-left-radius: 5px;
            backdrop-filter: blur(10px);
        }
        /* Style for canvas container */
        .message-bubble.agent .content .chart-container {
             width: 100%;
             max-width: 450px; /* Adjust max width as needed */
             margin-top: 15px;
             background-color: rgba(255, 255, 255, 0.05); /* Slightly lighter background */
             padding: 15px;
             border-radius: 8px;
             border: 1px solid var(--border-color);
        }
         .message-bubble.agent .content canvas {
             max-width: 100%;
             height: auto;
         }

        /* Styles for rendered Markdown in agent bubbles */
        .message-bubble.agent .content h1,
        .message-bubble.agent .content h2,
        .message-bubble.agent .content h3 { color: var(--primary-blue); margin-top: 1em; margin-bottom: 0.5em; border-bottom: 1px solid var(--border-color); padding-bottom: 4px; }
        .message-bubble.agent .content h4 { color: var(--text-dark); margin-top: 1em; margin-bottom: 0.5em; }
        .message-bubble.agent .content p { margin-top: 0.5em; margin-bottom: 0.5em; }
        .message-bubble.agent .content ul, .message-bubble.agent .content ol { padding-left: 20px; margin: 0.5em 0; }
        .message-bubble.agent .content li { margin-bottom: 0.5em; }
        .message-bubble.agent .content hr { border: none; border-top: 1px solid var(--border-color); margin: 1em 0; }
        .message-bubble.agent .content strong { color: var(--text-dark); }
        .message-bubble.agent .content code {
            background-color: rgba(0, 0, 0, 0.3);
            padding: 2px 5px;
            border-radius: 4px;
            font-family: monospace;
        }
        .message-bubble.agent .content pre {
            background-color: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            overflow-x: auto;
        }
        .message-bubble.agent .content pre code {
            background-color: transparent;
            padding: 0;
        }
        .message-bubble.agent .content a {
            color: var(--primary-blue);
            text-decoration: none;
            font-weight: 500;
        }
        .message-bubble.agent .content a:hover {
            text-decoration: underline;
        }
        .message-bubble.agent .content blockquote {
            border-left: 4px solid var(--primary-blue);
            padding-left: 15px;
            margin-left: 0;
            font-style: italic;
            color: var(--text-light);
            opacity: 0.9;
        }
         /* Markdown table styling */
        .message-bubble.agent .content table {
            width: auto; /* Allow table to fit content */
            max-width: 100%; /* Prevent overflow */
            border-collapse: collapse;
            margin: 1em 0;
            font-size: 0.9em;
            background-color: rgba(0,0,0,0.1);
        }
        .message-bubble.agent .content th,
        .message-bubble.agent .content td {
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            text-align: left;
        }
        .message-bubble.agent .content th {
            background-color: rgba(0, 169, 157, 0.2);
            color: var(--text-dark);
            font-weight: 600;
        }
        .message-bubble.agent .content tr:nth-child(even) {
            background-color: rgba(255,255,255,0.05);
        }

        .chat-input-area {
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(0, 0, 0, 0.1);
            /*margin: 0 -20px -20px -20px;*/
            padding: 15px 20px;
            border-radius: 0 0 20px 0; /* Only bottom-right corner of chat-area */
            flex-shrink: 0;
        }
        .chat-input-controls { display: flex; align-items: center; gap: 12px; flex-shrink: 0; }
        #chatInput {
            flex: 1;
            min-width: 0;
            width: 100%;
            background: transparent;
            border: none;
            outline: none;
            color: var(--text-dark);
            font-size: 1rem;
            padding: 12px 0;
            font-family: 'Poppins', sans-serif;
        }
        #chatInput::placeholder { color: var(--text-light); opacity: 0.6; }
        .chat-input-controls button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .chat-input-controls button:hover {
            color: var(--text-dark);
            background: var(--primary-blue);
            border-color: var(--primary-blue);
            transform: scale(1.1);
        }
        .send-btn {
            background: linear-gradient(135deg, var(--primary-blue), #008a7e) !important;
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(0, 169, 157, 0.4);
        }
        .send-btn:hover {
            box-shadow: 0 6px 20px rgba(0, 169, 157, 0.6) !important;
            transform: scale(1.1) !important;
        }

        .summary-section {
            flex: 0 0 280px;
            background: var(--container-bg);
            border-radius: 20px;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(20px);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-width: 280px;
            min-height: 0;
            max-height: calc(100vh - 220px);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }
        
        .placeholder-page, .agenda-container {
            flex: 1;
            background: var(--container-bg);
            border-radius: 20px;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(20px);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-width: 300px;
            min-height: 0;
            max-height: calc(100vh - 220px);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }
        .summary-header { display: flex; justify-content: space-between; align-items: center; }
        .summary-header h3 { margin: 0; font-size: 1.3rem; color: var(--text-dark); font-weight: 600; }
        .summary-header button {
            background: var(--container-bg-light);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            padding: 10px 18px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .summary-header button:hover {
            background: linear-gradient(135deg, var(--primary-blue), #008a7e);
            color: #fff;
            border-color: var(--primary-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 169, 157, 0.4);
        }
        .summary-content { font-size: 0.95rem; line-height: 1.7; color: var(--text-light); overflow-y: auto; flex: 1; min-height: 0; }
        .summary-content h4 {
            color: var(--primary-blue);
            margin-top: 20px;
            margin-bottom: 12px;
            font-weight: 600;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 8px;
            font-size: 1.1rem;
            text-shadow: 0 2px 10px rgba(0, 169, 157, 0.2);
        }
        .summary-content h4:first-child { margin-top: 0; }
        .summary-content ul { list-style-type: none; padding-left: 15px; margin-top: 10px; }
        .summary-content ul li { position: relative; padding-left: 20px; margin-bottom: 8px; }
        .summary-content ul li::before { content: '▶'; position: absolute; left: 0; top: 0; color: var(--primary-blue); font-size: 0.8em; }
        .summary-content ul li strong { color: var(--text-dark); }
        .key-topics-pills { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 15px; }
        .key-topic-pill { background: var(--container-bg-light); border: 1px solid var(--border-color); color: var(--text-light); padding: 5px 12px; border-radius: 15px; font-size: 0.85rem; cursor: pointer; transition: all 0.2s; }
        .key-topic-pill:hover { background: var(--primary-blue); color: var(--text-dark); border-color: var(--primary-blue); }

        .typing-indicator { display: flex; align-items: center; }
        .typing-indicator span { height: 8px; width: 8px; margin: 0 2px; background-color: var(--primary-blue); border-radius: 50%; display: inline-block; animation: bounce 1.4s infinite ease-in-out both; }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }

        .placeholder-page h2 { color: var(--primary-blue); text-align: center; }
        .placeholder-page p { text-align: center; font-size: 1.1rem; }
        /* Style for AI Tools Cards */
        #tools-page { flex-direction: column; } /* Ensure tools page stacks vertically */
        .tools-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* Responsive grid */
            gap: 20px;
            width: 100%;
            padding: 20px 0; /* Add padding around the grid */
        }
        .tool-card {
            background: var(--container-bg);
            border-radius: 15px;
            border: 1px solid var(--border-color);
            padding: 25px;
            display: flex;
            flex-direction: column;
            align-items: center; /* Center icon and text */
            text-align: center; /* Center text */
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-sm);
            backdrop-filter: blur(15px);
        }
        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-blue);
            background: linear-gradient(135deg, var(--container-bg), rgba(0, 169, 157, 0.1));
        }
        .tool-icon {
            font-size: 2.2rem;
            color: var(--primary-blue);
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        .tool-card:hover .tool-icon {
            transform: scale(1.1);
            text-shadow: 0 2px 15px rgba(0, 169, 157, 0.4);
        }
        .tool-title {
            color: var(--text-dark);
            margin: 0 0 10px 0;
            font-size: 1.1rem;
            font-weight: 600;
        }
        .tool-description {
            font-size: 0.85rem;
            line-height: 1.6;
            opacity: 0.85;
            flex-grow: 1; /* Allow description to take space */
            margin-bottom: 15px; /* Space before button */
        }
        .tool-action-btn {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
            display: inline-flex; /* Make it inline */
            align-items: center;
            gap: 6px;
            margin-top: auto; /* Push button to bottom */
        }
        .tool-action-btn:hover {
            background: linear-gradient(135deg, var(--primary-blue), #008a7e);
            color: var(--text-dark);
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0, 169, 157, 0.3);
            border-color: transparent;
        }


        .agenda-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .agenda-header h2 {
            margin: 0;
            font-weight: 600;
            font-size: 1.5rem;
            color: var(--text-dark);
            text-shadow: 0 2px 10px rgba(0, 169, 157, 0.2);
            flex: 1 1 auto;
            min-width: 150px;
        }

        .view-toggle {
            display: flex;
            gap: 5px;
            background: var(--container-bg-light);
            padding: 4px;
            border-radius: 25px;
            border: 1px solid var(--border-color);
        }

        .view-toggle button,
        .mobile-view-btn {
            background: transparent;
            border: none;
            color: var(--text-light);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
            font-weight: 500;
        }

        .view-toggle button.active,
        .mobile-view-btn.active {
            background: linear-gradient(135deg, var(--primary-blue), #008a7e);
            color: var(--text-dark);
            box-shadow: 0 2px 10px rgba(0, 169, 157, 0.4);
        }

        .view-toggle button:hover:not(.active),
        .mobile-view-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }

        .agenda-view {
            display: none;
            flex-grow: 1;
            min-height: 0;
            overflow-y: auto;
        }

        .agenda-view.active {
            display: block;
        }

        #today-view.active,
        #week-view.active {
            display: flex !important; /* Use flex for week view grid */
            flex-direction: column;
            gap: 15px;
        }

        #month-view.active {
            display: flex !important; /* Use flex for month view grid */
            flex-direction: column;
        }

        .month-calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 15px;
            flex-grow: 1;
            min-height: 0;
            grid-template-rows: auto repeat(6, 1fr); /* Header row + 6 weeks */
        }

        .month-day-header {
            text-align: center;
            font-weight: 600;
            font-size: 0.85rem;
            opacity: 0.7;
            padding: 10px 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .month-day-header.weekend {
            background-color: rgba(0, 0, 0, 0.15);
            border-radius: 5px 5px 0 0;
        }

        .month-day-cell {
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 8px;
            background: var(--container-bg-light);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .month-day-cell:hover {
            background: rgba(0, 169, 157, 0.2);
            transform: scale(1.02);
            border-color: var(--primary-blue);
        }

        .month-day-cell.weekend {
            background-color: rgba(0, 0, 0, 0.15);
        }

        .month-day-cell.today {
            border: 2px solid var(--primary-blue);
            background: rgba(0, 169, 157, 0.15);
            box-shadow: 0 0 15px rgba(0, 169, 157, 0.3);
        }

        .month-day-cell.other-month,
        .month-day-cell.disabled-day {
            opacity: 0.3;
            pointer-events: none;
            background: transparent;
        }

        .month-day-number {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 5px;
            flex-shrink: 0;
        }

        .month-day-events {
            display: flex;
            flex-direction: column;
            gap: 3px;
            flex-grow: 1;
            overflow: hidden;
        }

        .month-event-dot {
            width: 100%;
            height: 4px;
            background: var(--primary-blue);
            border-radius: 2px;
            font-size: 0.7rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .month-event-dot.milestone {
            background: #ffc107;
        }

        .today-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 15px;
        }

        .today-date {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .today-events-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .desktop-calendar { display: block; }
        .mobile-calendar { display: none; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; flex: 1; }
        .day-column { border-right: 1px solid var(--border-color); padding: 5px; }
        .day-column:last-child { border-right: none; }
        .day-column.weekend { background-color: rgba(0, 0, 0, 0.2); border-radius: 5px; }
        .day-header {
            text-align: center;
            font-weight: 600;
            padding-bottom: 8px;
            margin-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }
        .day-header .day-name {
            font-size: 0.75em;
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .day-header .day-number {
            font-size: 1.4em;
            margin-top: 5px;
            color: var(--text-dark);
            font-weight: 700;
        }
        .event {
            background: linear-gradient(135deg, rgba(0, 169, 157, 0.15), rgba(0, 169, 157, 0.25));
            border-left: 4px solid var(--primary-blue);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .event:hover {
            background: linear-gradient(135deg, rgba(0, 169, 157, 0.3), rgba(0, 169, 157, 0.4));
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0, 169, 157, 0.3);
        }
        .event-time { font-size: 0.8em; opacity: 0.9; margin-bottom: 5px; font-weight: 500; }
        .event-title { font-weight: 600; color: var(--text-dark); font-size: 0.95rem; }
        .event-milestone {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.15), rgba(255, 193, 7, 0.25));
            border-left-color: #ffc107;
        }
        .event-milestone:hover {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.3), rgba(255, 193, 7, 0.4));
        }

        .topics-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; width: 100%; }
        .topic-card {
            background: var(--container-bg);
            border-radius: 20px;
            border: 1px solid var(--border-color);
            padding: 25px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-md);
            backdrop-filter: blur(20px);
        }
        .topic-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 40px rgba(0, 169, 157, 0.3);
            border-color: var(--primary-blue);
            background: linear-gradient(135deg, var(--container-bg), rgba(0, 169, 157, 0.1));
        }
        .topic-icon {
            font-size: 2.5rem;
            color: var(--primary-blue);
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        .topic-card:hover .topic-icon {
            transform: scale(1.1) rotate(5deg);
            text-shadow: 0 4px 20px rgba(0, 169, 157, 0.5);
        }
        .topic-title {
            color: var(--text-dark);
            margin: 0 0 10px 0;
            font-size: 1.3rem;
            font-weight: 600;
        }
        .topic-description {
            font-size: 0.9rem;
            line-height: 1.7;
            margin-bottom: 20px;
            flex-grow: 1;
            opacity: 0.9;
        }
        .topic-kpis {
            display: flex;
            gap: 25px;
            margin-bottom: 20px;
            padding: 20px 0;
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
        }
        .kpi-item {
            text-align: center;
            flex: 1;
        }
        .kpi-value {
            display: block;
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-blue);
            text-shadow: 0 2px 10px rgba(0, 169, 157, 0.3);
        }
        .kpi-label {
            font-size: 0.75rem;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .topic-actions {
            display: flex;
            gap: 10px;
            padding-top: 15px;
        }
        .topic-actions button {
            flex: 1;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            padding: 10px 12px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        .topic-actions button:hover {
            background: linear-gradient(135deg, var(--primary-blue), #008a7e);
            color: var(--text-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 169, 157, 0.4);
            border-color: transparent;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal-content {
            background: var(--container-bg);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(30px);
            padding: 35px;
            border-radius: 20px;
            width: 650px;
            max-width: 90%;
            text-align: left;
            position: relative;
            animation: slideInModal 0.4s cubic-bezier(0.4, 0, 0.2, 1); /* Renamed animation */
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        @keyframes slideInModal { /* Renamed animation */
            from {
                transform: translateY(-50px) scale(0.9);
                opacity: 0;
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }
        .close-button {
            color: #aaa;
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        .close-button:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(90deg);
        }
        .modal-content h2 {
            margin-top: 0;
            color: var(--primary-blue);
            margin-bottom: 25px;
            text-align: center;
            font-size: 1.5rem;
            text-shadow: 0 2px 10px rgba(0, 169, 157, 0.3);
        }
        #event-modal-title { font-size: 1.5rem; color: var(--text-dark); margin: 0 0 5px 0; text-align: left; }
        #event-modal-time { color: var(--primary-blue); font-weight: 500; margin-bottom: 15px; text-align: left; }
        #event-modal-details { margin-bottom: 20px; line-height: 1.6; text-align: left;}
        .event-actions, .day-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
            margin-top: 10px;
        }
        .event-actions button, .day-actions button {
            flex: 1;
            background: var(--container-bg-light);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: 500;
        }
        .event-actions button:hover, .day-actions button:hover {
            background: linear-gradient(135deg, var(--primary-blue), #008a7e);
            color: var(--text-dark);
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 169, 157, 0.4);
        }

        .persona-options { display: flex; flex-direction: column; gap: 15px; }
        .persona-option {
            display: flex;
            align-items: center;
            gap: 20px;
            cursor: pointer;
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 18px;
            background: var(--container-bg-light);
            transition: all 0.3s ease-in-out;
        }
        .persona-option:hover {
            background-color: rgba(0, 169, 157, 0.2);
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0, 169, 157, 0.2);
        }
        .persona-option.selected {
            border-color: var(--primary-blue);
            box-shadow: 0 0 20px rgba(0, 169, 157, 0.4);
            background: linear-gradient(135deg, rgba(0, 169, 157, 0.15), rgba(0, 169, 157, 0.25));
        }
        .persona-option img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--border-color);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .persona-option.selected img {
            border-color: var(--primary-blue);
        }
        .persona-details h4 {
            margin: 0 0 8px 0;
            color: var(--text-dark);
            font-size: 1.1rem;
        }
        .persona-details p {
            margin: 0;
            font-size: 0.9rem;
            color: var(--text-light);
            opacity: 0.85;
            line-height: 1.5;
        }

        .key-topic-pill, .modal-topic-pill {
            background: var(--container-bg-light);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        .key-topic-pill:hover, .modal-topic-pill:hover, .modal-topic-pill.active {
            background: linear-gradient(135deg, var(--primary-blue), #008a7e);
            color: var(--text-dark);
            border-color: var(--primary-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 169, 157, 0.4);
        }

        .modal-pills-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 10px 0;
        }

        #meetings-modal-list .meeting-item {
            cursor: pointer;
            transition: all 0.3s;
            background: var(--container-bg-light);
            padding: 18px;
            border-radius: 12px;
            margin-bottom: 12px;
            border-left: 4px solid var(--primary-blue);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        #meetings-modal-list .meeting-item:hover {
            background: linear-gradient(135deg, rgba(0, 169, 157, 0.15), rgba(0, 169, 157, 0.25));
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0, 169, 157, 0.3);
        }
        #meetings-modal-list .meeting-title {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 1.05rem;
            margin-bottom: 5px;
        }
        #meetings-modal-list .meeting-time {
            font-size: 0.9em;
            opacity: 0.8;
            color: var(--primary-blue);
        }
        #meetings-modal-list .dropdown-header, #dayActionModal .dropdown-header {
            font-size: 0.85rem;
            text-transform: uppercase;
            opacity: 0.7;
            padding: 20px 0 10px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 15px;
            font-weight: 600;
            letter-spacing: 1px;
        }



        #ask-agent-btn {
            position: absolute;
            display: none;
            background: var(--container-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--primary-blue);
            color: var(--text-light);
            padding: 10px 16px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            z-index: 1001;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 169, 157, 0.4);
            font-weight: 500;
        }
        #ask-agent-btn:hover {
            background: linear-gradient(135deg, var(--primary-blue), #008a7e);
            color: var(--text-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0, 169, 157, 0.6);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-blue);
            border-radius: 10px;
            transition: background 0.3s;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #008a7e;
        }

        @media (max-width: 1200px) {
            .page-content { flex-direction: column; }
            .persona-display { 
                flex: 0 0 auto;
                width: 100%;
                max-width: 700px;
                margin: 0 auto 20px;
                padding: 20px;
            }
            .multi-agent-header h3 {
                font-size: 1.1rem;
            }
            .agent-selection-list {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 10px;
            }
            .agent-select-item {
                flex: 1;
                min-width: 200px;
            }
            .chat-section-container { flex-direction: column; max-height: 60vh; }
            .summary-section, .agenda-container { max-height: 60vh; }
            .tools-container { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
        }

        @media (max-width: 768px) {
            body {
                height: 100vh;
                height: calc(var(--vh, 1vh) * 100);
                display: flex;
                flex-direction: column;
            }
            .header { padding: 15px 20px; }
            .header-left span, .header-right .welcome-text { display: none; }
            .mobile-menu-btn { display: block; }

            .nav-tabs-container {
                display: none; /* Hidden by default */
                position: fixed;
                top: 73px; /* Height of header */
                left: 0;
                right: 0;
                height: auto;
                background: var(--dark-teal); /* Solid background for mobile menu */
            }
            .nav-tabs-container.active {
                display: flex;
            }
            .nav-tabs {
                flex-direction: column;
                width: 100%;
                padding: 10px;
                gap: 0;
            }
            .nav-tabs button {
                justify-content: flex-start;
                border-radius: 8px;
            }

            .main-container {
                flex-grow: 1;
                display: flex;
                overflow: hidden; /* Prevent body scrolling */
            }

            .page-content {
                padding: 0;
                gap: 0;
                flex-grow: 1;
                height: 100%; /* Take full height of main-container */
                overflow: hidden; /* Page content itself handles scrolling */
            }

            .chat-section-container {
                width: 100%;
                height: 100%;
                border-radius: 0;
                padding: 1rem;
                max-height: none;
                box-sizing: border-box; /* Ensure padding is included in height */
            }

            .persona-display {
                display: block;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: var(--container-bg);
                backdrop-filter: blur(30px);
                border-radius: 20px 20px 0 0;
                border: 1px solid var(--border-color);
                border-bottom: none;
                padding: 12px 15px 15px;
                max-height: 50vh;
                overflow-y: auto;
                z-index: 900;
                transform: translateY(calc(100% - 55px));
                transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                box-shadow: 0 -4px 30px rgba(0, 0, 0, 0.5);
            }
            
            .persona-display.expanded {
                transform: translateY(0);
            }
            
            /* Mode Toggle on Mobile */
            .mode-toggle-container {
                padding: 6px 8px;
                margin-bottom: 8px;
                gap: 6px;
            }
            
            .mode-toggle-label {
                font-size: 0.7rem;
                font-weight: 600;
            }
            
            .mode-toggle-switch {
                width: 46px;
                height: 24px;
            }
            
            .mode-toggle-slider {
                border-width: 2px;
            }
            
            .mode-toggle-slider:before {
                height: 16px;
                width: 16px;
                font-size: 0.6rem;
                left: 2px;
                bottom: 2px;
            }
            
            .mode-toggle-switch input:checked + .mode-toggle-slider:before {
                transform: translateX(22px);
                font-size: 0.7rem;
            }
            
            /* Single Agent Display on Mobile */
            .single-agent-avatar {
                width: 100px;
                height: 100px;
                border-width: 3px;
            }
            
            .single-agent-name {
                font-size: 1.1rem;
            }
            
            .single-agent-title {
                font-size: 0.8rem;
            }
            
            .single-agent-description {
                font-size: 0.75rem;
                padding: 0;
            }
            
            /* Multi-Agent Header */
            .multi-agent-header {
                cursor: pointer;
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 12px;
                padding: 8px;
                border-radius: 10px;
                background: rgba(0, 169, 157, 0.1);
                transition: background 0.3s;
            }
            
            .multi-agent-header:active {
                background: rgba(0, 169, 157, 0.2);
            }
            
            .multi-agent-header h3 {
                margin: 0 !important;
                font-size: 1rem !important;
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .multi-agent-header p {
                display: none !important; /* Hide subtitle on mobile */
            }
            
            .multi-agent-header::after {
                content: '▼';
                font-size: 1.3rem;
                color: var(--primary-blue);
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                flex-shrink: 0;
            }
            
            .persona-display.expanded .multi-agent-header::after {
                transform: rotate(180deg);
            }
            
            .persona-display:not(.expanded) .agent-selection-list,
            .persona-display:not(.expanded) .quick-actions {
                display: none;
            }
            
            /* Agent Selector Button on Mobile */
            #agentSelectorBtn {
                padding: 5px;
                width: 60px !important;
                min-width: 60px;
                gap: 3px;
            }
            
            #agentSelectorBtn img {
                width: 28px;
                height: 28px;
                border-width: 1.5px;
            }
            
            #agentSelectorBtn i {
                font-size: 0.65rem;
            }
            
            .agent-selection-list {
                gap: 10px;
                max-height: calc(50vh - 120px);
                overflow-y: auto;
            }
            
            .agent-select-item {
                padding: 10px 12px;
                border-radius: 14px;
                min-height: 60px;
            }
            
            .agent-toggle {
                width: 48px;
                height: 28px;
                margin-right: 12px;
            }
            
            .agent-toggle-slider {
                border-width: 2px;
            }
            
            .agent-toggle-slider:before {
                height: 20px;
                width: 20px;
                left: 2px;
                bottom: 2px;
            }
            
            .agent-checkbox:checked + .agent-toggle .agent-toggle-slider:before {
                transform: translateX(20px);
            }
            
            .agent-mini-avatar {
                width: 38px;
                height: 38px;
                margin-right: 10px;
            }
            
            .agent-select-name {
                font-size: 0.9rem;
                font-weight: 600;
            }
            
            .agent-select-title {
                font-size: 0.72rem;
                margin-top: 2px;
            }
            
            .multi-agent-badge {
                font-size: 0.75rem;
                padding: 3px 9px;
            }
            
            .quick-actions {
                margin-top: 12px;
                padding-top: 12px;
                border-top: 1px solid var(--border-color);
            }
            
            .quick-actions h4 {
                font-size: 0.9rem;
                margin-bottom: 8px;
            }
            
            .quick-action-btn {
                padding: 10px 14px;
                font-size: 0.85rem;
            }
            
            .summary-section {
                display: none;
            }

            .chat-interaction-area {
                height: 100%;
                padding-bottom: 65px; /* Space for the collapsed agent selector */
                display: flex;
                flex-direction: column;
            }
            
            .chat-messages {
                flex: 1;
                overflow-y: auto;
                padding-bottom: 10px;
            }

            .chat-input-area {
                padding-bottom: env(safe-area-inset-bottom);
                padding: 20px 15px;
                margin: 0 -1rem -1rem -1rem;
            }
            
            #chatInput {
                padding-top: 15px;
                padding-bottom: 15px;
                font-size: 0.95rem;
            }
            
            .chat-input-controls {
                flex-wrap: wrap;
                gap: 6px;
            }

            .chat-input-controls button {
                width: 40px;
                height: 40px;
                font-size: 0.85rem;
            }
            
            .chat-input-controls button:not(#agentSelectorBtn):not(.send-btn) {
                flex-shrink: 0;
            }

            .send-btn {
                width: 48px !important;
                height: 48px !important;
            }

            #topics-page, #agenda-page, .placeholder-page, #tools-page {
                padding: 0;
                width: 100%;
                box-sizing: border-box;
                overflow-y: auto;
                overflow-x: hidden;
                height: 100%;
            }

            .topics-container, .tools-container {
                padding: 15px;
                grid-template-columns: 1fr;
                height: auto;
                width: 100%;
                box-sizing: border-box;
            }
            .tool-card { padding: 20px; }
            .tool-icon { font-size: 2rem; }
            .tool-title { font-size: 1rem; }
            .tool-description { font-size: 0.8rem; }


            .topic-card {
                margin-bottom: 15px;
                width: 100%;
                box-sizing: border-box;
                padding: 15px;
            }

            .topic-icon {
                font-size: 1.8rem;
                margin-bottom: 10px;
            }

            .topic-title {
                font-size: 1.1rem;
            }

            .topic-description {
                font-size: 0.85rem;
                margin-bottom: 15px;
                line-height: 1.5;
            }

            .topic-kpis {
                gap: 15px;
                margin-bottom: 15px;
                padding: 15px 0;
            }

            .kpi-value {
                font-size: 1.5rem;
            }

            .kpi-label {
                font-size: 0.7rem;
            }

            .topic-actions {
                flex-direction: column;
                gap: 8px;
            }

            .topic-actions button {
                width: 100%;
                box-sizing: border-box;
            }

            .agenda-container {
                width: 100%;
                padding: 10px;
                box-sizing: border-box;
                max-height: none;
                border-radius: 0;
                overflow: hidden;
                height: 100%; /* Full page height */
                display: flex; /* Allow mobile calendar to grow */
                flex-direction: column;
            }

            .modal-content {
                padding: 25px 20px;
                max-height: 80vh;
            }

            .modal-content h2 {
                font-size: 1.3rem;
            }

            #event-modal-title {
                font-size: 1.2rem;
            }

            .modal-topic-pill {
                font-size: 0.85rem;
                padding: 7px 13px;
            }
            .placeholder-page {
                padding: 30px 20px;
            }

            .placeholder-page h2 {
                font-size: 1.5rem;
            }

            .placeholder-page p {
                font-size: 1rem;
            }

            #meetings-modal-list .meeting-title {
                font-size: 0.95rem;
            }

            #meetings-modal-list .meeting-time {
                font-size: 0.85rem;
            }

            #mobile-agenda-events .event {
                margin-bottom: 12px;
            }

            .desktop-calendar { display: none; }

            .mobile-calendar {
                display: flex;
                flex-direction: column;
                flex-grow: 1;
                width: 100%;
                overflow-x: hidden;
                box-sizing: border-box;
                height: 100%; /* Take remaining height */
                min-height: 0; /* Allow flex shrinking */
            }

            .agenda-header {
                padding-bottom: 15px;
                margin-bottom: 15px;
                flex-shrink: 0; /* Prevent header from shrinking */
            }

            .agenda-header h2 {
                font-size: 1.3rem;
            }

            .view-toggle {
                width: 100%;
                justify-content: center;
            }

            .view-toggle button,
            .mobile-view-btn {
                font-size: 0.85rem;
                padding: 8px 14px;
            }

            #mobile-month-grid {
                display: grid;
                grid-template-columns: repeat(7, 1fr);
                gap: 3px;
                width: 100%;
                box-sizing: border-box;
                flex-shrink: 0; /* Prevent grid from shrinking */
            }

            #mobile-month-grid .day-name {
                text-align: center;
                font-size: 0.7em;
                opacity: 0.7;
                padding-bottom: 3px;
            }

            #mobile-month-grid .day-cell {
                position: relative;
                text-align: center;
                cursor: pointer;
                border-radius: 50%;
                font-size: 0.9rem;
                box-sizing: border-box;
                aspect-ratio: 1 / 1;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 2px auto;
                width: 40px;
                height: 40px;
                transition: all 0.3s;
                font-weight: 500;
            }

            #mobile-month-grid .day-cell:hover {
                background-color: rgba(0, 169, 157, 0.2);
                transform: scale(1.1);
            }

            #mobile-month-grid .day-cell.selected {
                background: linear-gradient(135deg, var(--primary-blue), #008a7e);
                color: var(--text-dark);
                box-shadow: 0 4px 15px rgba(0, 169, 157, 0.5);
                font-weight: 700;
            }

            #mobile-month-grid .day-cell.today {
                font-weight: bold;
                border: 2px solid var(--primary-blue);
                box-shadow: 0 0 15px rgba(0, 169, 157, 0.3);
                background: rgba(0, 169, 157, 0.15);
            }

            #mobile-month-grid .day-cell.has-event::after {
                content: '';
                position: absolute;
                bottom: 2px;
                left: 50%;
                transform: translateX(-50%);
                width: 5px;
                height: 5px;
                background-color: var(--primary-blue);
                border-radius: 50%;
                box-shadow: 0 0 8px rgba(0, 169, 157, 0.8);
            }

            #mobile-month-grid .day-cell.selected.has-event::after {
                background-color: white;
            }

            #mobile-month-grid .day-cell.today.has-event::after {
                background-color: var(--primary-blue);
            }

            .month-calendar-grid {
                gap: 5px;
            }

            .month-day-cell {
                min-height: 60px;
                font-size: 0.85rem;
                padding: 5px;
            }

            .month-day-number {
                font-size: 0.85rem;
            }

            .month-event-dot {
                height: 3px;
            }

            #mobile-agenda-events {
                margin-top: 15px;
                padding-top: 15px;
                border-top: 1px solid var(--border-color);
                flex-grow: 1;
                overflow-y: auto;
                min-height: 0; /* Allow this to shrink and grow */
            }
        }
    </style>
<style>.BDTLL_status {
    cursor: pointer;
    display: inline;
    margin-right: 3px;
    width: 16px;
    height: 16px;
}
/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3BhZ2VzL2NvbXBvbmVudHMvdG9vbHRpcC5jc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7SUFDSSxlQUFlO0lBQ2YsZUFBZTtJQUNmLGlCQUFpQjtJQUNqQixXQUFXO0lBQ1gsWUFBWTtBQUNoQiIsInNvdXJjZXNDb250ZW50IjpbIi5CRFRMTF9zdGF0dXMge1xuICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICBkaXNwbGF5OiBpbmxpbmU7XG4gICAgbWFyZ2luLXJpZ2h0OiAzcHg7XG4gICAgd2lkdGg6IDE2cHg7XG4gICAgaGVpZ2h0OiAxNnB4O1xufSJdLCJzb3VyY2VSb290IjoiIn0= */</style><style>.BDTLL_icon_ok {
    background-image: url(data:image/png;base64,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);
}

.BDTLL_icon_critical {
    background-image: url(data:image/png;base64,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);
}

.BDTLL_icon_alert {
    background-image: url(data:image/png;base64,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);
}

.BDTLL_icon_disabled {
    background-image: url(data:image/png;base64,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);
}

.BDTLL_icon_whitelisted {
    background-image: url(data:image/png;base64,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);
}

.BDTLL_Search_Popup {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', system-ui;

	position: absolute !important;
	min-height: 70px !important;

	border-style: solid !important;
	border-width: 1px !important;
	border-radius: 5px !important;

	overflow: hidden !important;
	z-index: 999999999999999 !important;

    background-color: rgb(255, 255, 255) !important;
    border-color: rgba(100, 100, 100, 0.9) !important;
}

.BDTLL_Search_Popup > .BDTLL_left_box {
	position: absolute !important;
	top: 0px !important;
	height: auto !important;
	bottom: 0px !important;

	left: 0px !important;
	width: 92px !important;

	background-size: 50px 50px !important;
	background-repeat: no-repeat !important;
	background-position: center !important;

    background-color: rgb(240, 242, 246) !important;
}

.BDTLL_Search_Popup > .BDTLL_right_box {
	display: inline-block !important;
	margin-left: 92px !important;
	width: 210pt !important;

	box-sizing: border-box !important;
	padding-left: 10px !important;
    padding-right: 5px !important;
}

.BDTLL_Search_Popup p {
    white-space: pre-wrap !important;
    word-wrap: normal !important;
    margin: 0px !important;
    padding: 0px !important;
    text-align: left;
}

.BDTLL_Search_Popup .BDTLL_title {
	font-size: 16px !important;
	margin-top: 12px !important;
}

.BDTLL_Search_Popup .BDTLL_description {
	font-size: 12px !important;
	margin-top: 5px !important;
}

.BDTLL_Search_Popup .BDTLL_web_protection {
	font-size: 11px !important;
	margin-top: 15px !important;
	margin-bottom: 10px !important;
}

.BDTLL_Search_Popup .BDTLL_strong {
    color: rgb(7, 20, 45) !important;
}

.BDTLL_Search_Popup .BDTLL_mild {
    color: rgb(81, 91, 109) !important;
}

@media (prefers-color-scheme: dark) {
    .BDTLL_Search_Popup {
        background-color: rgb(56, 67, 87) !important;
        border-color: rgba(169, 169, 169, 0.9) !important;
    }

    .BDTLL_Search_Popup > .BDTLL_left_box {
        background-color: rgb(7, 20, 45) !important;
    }

    .BDTLL_Search_Popup .BDTLL_strong {
        color: rgb(239, 241, 249) !important;
    }
    
    .BDTLL_Search_Popup .BDTLL_mild {
        color: rgb(217, 217, 217) !important;
    }
}

/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3BhZ2VzL2FuYWx5emVyUG9wdXAvYW5hbHl6ZXJQYWdlU3RhdHVzLmNzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtJQUNJLHlEQUFnRDtBQUNwRDs7QUFFQTtJQUNJLHlEQUFzRDtBQUMxRDs7QUFFQTtJQUNJLHlEQUFtRDtBQUN2RDs7QUFFQTtJQUNJLHlEQUFzRDtBQUMxRDs7QUFFQTtJQUNJLHlEQUF5RDtBQUM3RDs7QUFFQTtJQUNJLCtFQUErRTs7Q0FFbEYsNkJBQTZCO0NBQzdCLDJCQUEyQjs7Q0FFM0IsOEJBQThCO0NBQzlCLDRCQUE0QjtDQUM1Qiw2QkFBNkI7O0NBRTdCLDJCQUEyQjtDQUMzQixtQ0FBbUM7O0lBRWhDLCtDQUErQztJQUMvQyxpREFBaUQ7QUFDckQ7O0FBRUE7Q0FDQyw2QkFBNkI7Q0FDN0IsbUJBQW1CO0NBQ25CLHVCQUF1QjtDQUN2QixzQkFBc0I7O0NBRXRCLG9CQUFvQjtDQUNwQixzQkFBc0I7O0NBRXRCLHFDQUFxQztDQUNyQyx1Q0FBdUM7Q0FDdkMsc0NBQXNDOztJQUVuQywrQ0FBK0M7QUFDbkQ7O0FBRUE7Q0FDQyxnQ0FBZ0M7Q0FDaEMsNEJBQTRCO0NBQzVCLHVCQUF1Qjs7Q0FFdkIsaUNBQWlDO0NBQ2pDLDZCQUE2QjtJQUMxQiw2QkFBNkI7QUFDakM7O0FBRUE7SUFDSSxnQ0FBZ0M7SUFDaEMsNEJBQTRCO0lBQzVCLHNCQUFzQjtJQUN0Qix1QkFBdUI7SUFDdkIsZ0JBQWdCO0FBQ3BCOztBQUVBO0NBQ0MsMEJBQTBCO0NBQzFCLDJCQUEyQjtBQUM1Qjs7QUFFQTtDQUNDLDBCQUEwQjtDQUMxQiwwQkFBMEI7QUFDM0I7O0FBRUE7Q0FDQywwQkFBMEI7Q0FDMUIsMkJBQTJCO0NBQzNCLDhCQUE4QjtBQUMvQjs7QUFFQTtJQUNJLGdDQUFnQztBQUNwQzs7QUFFQTtJQUNJLGtDQUFrQztBQUN0Qzs7QUFFQTtJQUNJO1FBQ0ksNENBQTRDO1FBQzVDLGlEQUFpRDtJQUNyRDs7SUFFQTtRQUNJLDJDQUEyQztJQUMvQzs7SUFFQTtRQUNJLG9DQUFvQztJQUN4Qzs7SUFFQTtRQUNJLG9DQUFvQztJQUN4QztBQUNKIiwic291cmNlc0NvbnRlbnQiOlsiLkJEVExMX2ljb25fb2sge1xuICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCguLi8uLi9pbWcvYW5hbHl6ZXJfb2sucG5nKTtcbn1cblxuLkJEVExMX2ljb25fY3JpdGljYWwge1xuICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCguLi8uLi9pbWcvYW5hbHl6ZXJfY3JpdGljYWwucG5nKTtcbn1cblxuLkJEVExMX2ljb25fYWxlcnQge1xuICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCguLi8uLi9pbWcvYW5hbHl6ZXJfYWxlcnQucG5nKTtcbn1cblxuLkJEVExMX2ljb25fZGlzYWJsZWQge1xuICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCguLi8uLi9pbWcvYW5hbHl6ZXJfZGlzYWJsZWQucG5nKTtcbn1cblxuLkJEVExMX2ljb25fd2hpdGVsaXN0ZWQge1xuICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCguLi8uLi9pbWcvYW5hbHl6ZXJfd2hpdGVsaXN0ZWQucG5nKTtcbn1cblxuLkJEVExMX1NlYXJjaF9Qb3B1cCB7XG4gICAgZm9udC1mYW1pbHk6IC1hcHBsZS1zeXN0ZW0sIEJsaW5rTWFjU3lzdGVtRm9udCwgJ1NlZ29lIFVJJywgJ1JvYm90bycsIHN5c3RlbS11aTtcblxuXHRwb3NpdGlvbjogYWJzb2x1dGUgIWltcG9ydGFudDtcblx0bWluLWhlaWdodDogNzBweCAhaW1wb3J0YW50O1xuXG5cdGJvcmRlci1zdHlsZTogc29saWQgIWltcG9ydGFudDtcblx0Ym9yZGVyLXdpZHRoOiAxcHggIWltcG9ydGFudDtcblx0Ym9yZGVyLXJhZGl1czogNXB4ICFpbXBvcnRhbnQ7XG5cblx0b3ZlcmZsb3c6IGhpZGRlbiAhaW1wb3J0YW50O1xuXHR6LWluZGV4OiA5OTk5OTk5OTk5OTk5OTkgIWltcG9ydGFudDtcblxuICAgIGJhY2tncm91bmQtY29sb3I6IHJnYigyNTUsIDI1NSwgMjU1KSAhaW1wb3J0YW50O1xuICAgIGJvcmRlci1jb2xvcjogcmdiYSgxMDAsIDEwMCwgMTAwLCAwLjkpICFpbXBvcnRhbnQ7XG59XG5cbi5CRFRMTF9TZWFyY2hfUG9wdXAgPiAuQkRUTExfbGVmdF9ib3gge1xuXHRwb3NpdGlvbjogYWJzb2x1dGUgIWltcG9ydGFudDtcblx0dG9wOiAwcHggIWltcG9ydGFudDtcblx0aGVpZ2h0OiBhdXRvICFpbXBvcnRhbnQ7XG5cdGJvdHRvbTogMHB4ICFpbXBvcnRhbnQ7XG5cblx0bGVmdDogMHB4ICFpbXBvcnRhbnQ7XG5cdHdpZHRoOiA5MnB4ICFpbXBvcnRhbnQ7XG5cblx0YmFja2dyb3VuZC1zaXplOiA1MHB4IDUwcHggIWltcG9ydGFudDtcblx0YmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdCAhaW1wb3J0YW50O1xuXHRiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXIgIWltcG9ydGFudDtcblxuICAgIGJhY2tncm91bmQtY29sb3I6IHJnYigyNDAsIDI0MiwgMjQ2KSAhaW1wb3J0YW50O1xufVxuXG4uQkRUTExfU2VhcmNoX1BvcHVwID4gLkJEVExMX3JpZ2h0X2JveCB7XG5cdGRpc3BsYXk6IGlubGluZS1ibG9jayAhaW1wb3J0YW50O1xuXHRtYXJnaW4tbGVmdDogOTJweCAhaW1wb3J0YW50O1xuXHR3aWR0aDogMjEwcHQgIWltcG9ydGFudDtcblxuXHRib3gtc2l6aW5nOiBib3JkZXItYm94ICFpbXBvcnRhbnQ7XG5cdHBhZGRpbmctbGVmdDogMTBweCAhaW1wb3J0YW50O1xuICAgIHBhZGRpbmctcmlnaHQ6IDVweCAhaW1wb3J0YW50O1xufVxuXG4uQkRUTExfU2VhcmNoX1BvcHVwIHAge1xuICAgIHdoaXRlLXNwYWNlOiBwcmUtd3JhcCAhaW1wb3J0YW50O1xuICAgIHdvcmQtd3JhcDogbm9ybWFsICFpbXBvcnRhbnQ7XG4gICAgbWFyZ2luOiAwcHggIWltcG9ydGFudDtcbiAgICBwYWRkaW5nOiAwcHggIWltcG9ydGFudDtcbiAgICB0ZXh0LWFsaWduOiBsZWZ0O1xufVxuXG4uQkRUTExfU2VhcmNoX1BvcHVwIC5CRFRMTF90aXRsZSB7XG5cdGZvbnQtc2l6ZTogMTZweCAhaW1wb3J0YW50O1xuXHRtYXJnaW4tdG9wOiAxMnB4ICFpbXBvcnRhbnQ7XG59XG5cbi5CRFRMTF9TZWFyY2hfUG9wdXAgLkJEVExMX2Rlc2NyaXB0aW9uIHtcblx0Zm9udC1zaXplOiAxMnB4ICFpbXBvcnRhbnQ7XG5cdG1hcmdpbi10b3A6IDVweCAhaW1wb3J0YW50O1xufVxuXG4uQkRUTExfU2VhcmNoX1BvcHVwIC5CRFRMTF93ZWJfcHJvdGVjdGlvbiB7XG5cdGZvbnQtc2l6ZTogMTFweCAhaW1wb3J0YW50O1xuXHRtYXJnaW4tdG9wOiAxNXB4ICFpbXBvcnRhbnQ7XG5cdG1hcmdpbi1ib3R0b206IDEwcHggIWltcG9ydGFudDtcbn1cblxuLkJEVExMX1NlYXJjaF9Qb3B1cCAuQkRUTExfc3Ryb25nIHtcbiAgICBjb2xvcjogcmdiKDcsIDIwLCA0NSkgIWltcG9ydGFudDtcbn1cblxuLkJEVExMX1NlYXJjaF9Qb3B1cCAuQkRUTExfbWlsZCB7XG4gICAgY29sb3I6IHJnYig4MSwgOTEsIDEwOSkgIWltcG9ydGFudDtcbn1cblxuQG1lZGlhIChwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaykge1xuICAgIC5CRFRMTF9TZWFyY2hfUG9wdXAge1xuICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoNTYsIDY3LCA4NykgIWltcG9ydGFudDtcbiAgICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDE2OSwgMTY5LCAxNjksIDAuOSkgIWltcG9ydGFudDtcbiAgICB9XG5cbiAgICAuQkRUTExfU2VhcmNoX1BvcHVwID4gLkJEVExMX2xlZnRfYm94IHtcbiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogcmdiKDcsIDIwLCA0NSkgIWltcG9ydGFudDtcbiAgICB9XG5cbiAgICAuQkRUTExfU2VhcmNoX1BvcHVwIC5CRFRMTF9zdHJvbmcge1xuICAgICAgICBjb2xvcjogcmdiKDIzOSwgMjQxLCAyNDkpICFpbXBvcnRhbnQ7XG4gICAgfVxuICAgIFxuICAgIC5CRFRMTF9TZWFyY2hfUG9wdXAgLkJEVExMX21pbGQge1xuICAgICAgICBjb2xvcjogcmdiKDIxNywgMjE3LCAyMTcpICFpbXBvcnRhbnQ7XG4gICAgfVxufVxuIl0sInNvdXJjZVJvb3QiOiIifQ== */</style></head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <img src="https://www.hrsd.gov.sa/themes/custom/hrsd_saud/logo_en.svg" alt="HRSD Logo" class="hrsd-logo">
            <span>| AI Executive Office</span>
        </div>
        <div class="header-right">
            <div class="user-profile">
                <span class="welcome-text">Welcome Ahmad</span>
                <img src="https://ui-avatars.com/api/?name=Ahmad&background=00A99D&color=fff&size=128" alt="User Avatar">
            </div>
            <button class="mobile-menu-btn"><i class="fas fa-bars"></i></button>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <div class="nav-tabs-container">
        <nav class="nav-tabs">
            <button class="nav-button active" data-target="agent-page"><i class="fas fa-robot"></i> AEO Agent</button>
            <button class="nav-button" data-target="topics-page"><i class="fas fa-th-large"></i> Focus Areas</button>
            <button class="nav-button" data-target="agenda-page"><i class="fas fa-calendar-alt"></i> Agenda</button>
            <button class="nav-button" data-target="tools-page"><i class="fas fa-cogs"></i> AI Tools</button>
            <button class="nav-button" data-target="compose-page"><i class="fas fa-pen-alt"></i> Compose</button>
            <button class="nav-button" data-target="templates-page"><i class="fas fa-file-alt"></i> Templates</button>
        </nav>
    </div>

    <!-- Main Content Container -->
    <div class="main-container">
        <!-- Agent Chat Page -->
        <main id="agent-page" class="page-content active">
            <section class="chat-section-container">
                <!-- Multi-Agent Selection Panel (Desktop) -->
                <div class="persona-display">
                    <!-- Mode Toggle -->
                    <div class="mode-toggle-container">
                        <span class="mode-toggle-label" id="singleModeLabel">Single Agent</span>
                        <label class="mode-toggle-switch">
                            <input type="checkbox" id="modeToggle">
                            <span class="mode-toggle-slider"></span>
                        </label>
                        <span class="mode-toggle-label active" id="multiModeLabel">Multi-Agent</span>
                    </div>
                    
                    <!-- Single Agent Display (for single mode) -->
                    <div class="single-agent-display" id="singleAgentDisplay">
                        <img id="singleAgentAvatar" src="https://api.dicebear.com/7.x/bottts/svg?seed=Hakim" alt="Agent Avatar" class="single-agent-avatar">
                        <div class="single-agent-info">
                            <div class="single-agent-name" id="singleAgentName">Hakim Nüruddin</div>
                            <div class="single-agent-title" id="singleAgentTitle">AI Executive Office Agent</div>
                            <div class="single-agent-description" id="singleAgentDescription">As your strategic partner, I provide high-level summaries, executive advice, and focus on strategic alignment for your key decisions.</div>
                        </div>
                    </div>
                    
                    <!-- Multi-Agent Content (for multi mode) -->
                    <div class="multi-agent-content" id="multiAgentContent">
                        <div class="multi-agent-header">
                            <h3 style="margin: 0 0 15px 0; color: var(--primary-blue);">
                                Active Agents
                                <span id="agentCountBadge" class="multi-agent-badge">1</span>
                            </h3>
                            <p style="font-size: 0.85rem; opacity: 0.8; margin-bottom: 15px;">Select one or more agents to assist you</p>
                        </div>
                        
                        <!-- Agent Selection List -->
                        <div id="agentSelectionList" class="agent-selection-list"><div class="agent-select-item selected">
                        <input type="checkbox" class="agent-checkbox" id="agent-toggle-hakim" data-agent-id="hakim" checked="">
                        <label for="agent-toggle-hakim" class="agent-toggle">
                            <span class="agent-toggle-slider"></span>
                        </label>
                        <img src="https://api.dicebear.com/7.x/bottts/svg?seed=Hakim" alt="Hakim Nüruddin" class="agent-mini-avatar">
                        <div class="agent-select-info">
                            <div class="agent-select-name">Hakim Nüruddin</div>
                            <div class="agent-select-title">AI Executive Office Agent</div>
                        </div>
                    </div><div class="agent-select-item ">
                        <input type="checkbox" class="agent-checkbox" id="agent-toggle-layla" data-agent-id="layla">
                        <label for="agent-toggle-layla" class="agent-toggle">
                            <span class="agent-toggle-slider"></span>
                        </label>
                        <img src="https://api.dicebear.com/7.x/bottts/svg?seed=Layla" alt="Layla Al-Farsi" class="agent-mini-avatar">
                        <div class="agent-select-info">
                            <div class="agent-select-name">Layla Al-Farsi</div>
                            <div class="agent-select-title">Data Analytics Agent</div>
                        </div>
                    </div><div class="agent-select-item ">
                        <input type="checkbox" class="agent-checkbox" id="agent-toggle-omar" data-agent-id="omar">
                        <label for="agent-toggle-omar" class="agent-toggle">
                            <span class="agent-toggle-slider"></span>
                        </label>
                        <img src="https://api.dicebear.com/7.x/bottts/svg?seed=Omar" alt="Omar Mansour" class="agent-mini-avatar">
                        <div class="agent-select-info">
                            <div class="agent-select-name">Omar Mansour</div>
                            <div class="agent-select-title">AI Coordinator</div>
                        </div>
                    </div></div>
                        
                        <div class="quick-actions" style="margin-top: 20px;">
                            <h4>Multi-Agent Actions</h4>
                            <button class="quick-action-btn" id="agentDiscussBtn" title="Let selected agents discuss among themselves">
                                <i class="fas fa-comments"></i>
                                <span>Agent Discussion</span>
                            </button>
                            <button class="quick-action-btn" data-action="agenda">
                                <i class="fas fa-calendar-day"></i>
                                <span>Today's Agenda</span>
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Chat Interaction Area -->
                <div class="chat-interaction-area">
                    <div class="chat-messages" id="chatMessages">
                        <div class="message-bubble agent">
                            <img src="https://api.dicebear.com/7.x/bottts/svg?seed=Hakim" alt="Agent Avatar" class="avatar" data-persona-avatar="">
                            <div class="content">Welcome your Highness. As-salāmu 'alaykum. I am Hakim, your AI Executive Office Agent. How may I assist you today?</div>
                        </div>
                    <div class="message-bubble user"><img src="https://ui-avatars.com/api/?name=Ahmad&background=00A99D&color=fff&size=128" alt="user Avatar" class="avatar"><div class="content">Can you dig deeper into the topic of "Empowering Society &amp; Individuals" for me? Provide key details and current status.</div></div><div class="message-bubble agent"><img src="https://api.dicebear.com/7.x/bottts/svg?seed=Hakim" alt="agent Avatar" class="avatar" data-persona-avatar=""><div class="content"><span class="agent-name-tag">Hakim Nüruddin</span><div><p><strong>To Your Highness,</strong></p>
<p>The topic of "Empowering Society &amp; Individuals" is a central axis of the National Transformation Program and HRSD’s mandate. It moves beyond mere provision of services toward <em>sustainable enablement</em> and the cultivation of a productive, self-reliant citizenry.</p>
<p>Here is a strategic summary detailing the key focus areas and current status as of Q4 2025.</p>
<hr>
<h3>STRATEGIC SUMMARY: EMPOWERING SOCIETY &amp; INDIVIDUALS</h3>
<p><strong>Core Definition:</strong> Transitioning the population from reliance on social assistance to active economic participation, while ensuring a robust quality of life and strengthening community governance.</p>
<table>
<thead>
<tr>
<th align="left">Strategic Pillar</th>
<th align="left">Key Details &amp; Focus</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>1. Human Capital &amp; Skills</strong></td>
<td align="left"><strong>Focus:</strong> Future-proofing the workforce and ensuring a higher Saudi participation rate. Emphasis is on targeted vocational training, linking education outcomes to market demand, and private sector job creation programs (e.g., Nitaqat optimization).</td>
</tr>
<tr>
<td align="left"><strong>2. Social Safety Nets Transformation</strong></td>
<td align="left"><strong>Focus:</strong> Shifting social security from unconditional assistance to empowering, conditional support. Programs are now focused on targeted intervention for the most vulnerable, coupling financial aid with mandatory upskilling and job placement assistance (The <strong>Enablement Approach</strong>).</td>
</tr>
<tr>
<td align="left"><strong>3. Non-Profit Sector Efficiency</strong></td>
<td align="left"><strong>Focus:</strong> Increasing the Third Sector’s contribution to GDP and improving governance. Driving the digital transformation of non-profits to enhance transparency, optimize donation streams, and increase localized service delivery capacity.</td>
</tr>
</tbody></table>
<hr>
<h3>CURRENT STATUS &amp; METRICS (Q4 2025 Snapshot)</h3>
<p>The focus this quarter has been on the integration of enablement tools and measuring the exit velocity from dependency programs.</p>
<h4>1. Workforce Empowerment Metrics</h4>
<ul>
<li><strong>Nationalization Rate:</strong> The overarching Saudization rate is showing strong stability, with significant gains observed in high-value, specialized sectors (e.g., IT, Finance) due to targeted subsidies and training mandates. HRSD’s focus is now moving from quantity of jobs to <strong>quality and salary levels</strong>.</li>
<li><strong>Unemployment:</strong> The national unemployment rate continues its downward trajectory, nearing pre-defined 2030 targets ahead of schedule. However, youth and female unemployment remain focus areas requiring bespoke, accelerated programs.</li>
</ul>
<h4>2. Social Program Integration</h4>
<ul>
<li><strong>Digital Profile Maturity:</strong> The unified digital platform for social benefits (linking data from the Ministry of Finance, HRSD, and other agencies) is highly operational. This integration is crucial for eliminating duplicate benefits and ensuring aid is strictly needs-based and conditional on participation in training/job search activities.</li>
<li><strong>Exit Velocity:</strong> Early data models show an encouraging increase in the rate at which beneficiaries successfully transition off social security support and into stable employment (the <strong>"Enablement Quotient"</strong>). This validates the shift to conditional aid.</li>
</ul>
<h4>3. Community Resilience</h4>
<ul>
<li><strong>Non-Profit Governance:</strong> Governance maturity scores for large-scale national charities have significantly improved due to stricter regulatory oversight and mandatory digital reporting standards. This enhances public trust and attracts investment.</li>
</ul>
<hr>
<h3>STRATEGIC INSIGHT</h3>
<p>The next phase requires moving from <em>program implementation</em> to <em>holistic ecosystem measurement</em>.</p>
<p>The primary risk is the potential for program overlap or lack of alignment between national training initiatives (Pillar 1) and social benefit conditioning (Pillar 2).</p>
<p><strong>Recommendation:</strong> We must prioritize the development of a unified <strong>Individual Empowerment Index (IEI)</strong>. This index will move beyond simple employment figures to measure the sustained financial independence, quality of life, and civic contribution of individuals leaving assistance programs, ensuring true, long-term empowerment rather than temporary relief.</p>
</div></div></div></div>
                    <div class="chat-input-area">
                        <input id="chatInput" type="text" placeholder="Ask me anything... Type or Talk">
                        <div class="chat-input-controls">
                            <button id="agentSelectorBtn" class="" title="Select Agent">
                                <img src="https://api.dicebear.com/7.x/bottts/svg?seed=Hakim" alt="Agent">
                                <i class="fas fa-chevron-down"></i>
                            </button>
                            <button id="chat-action-btn" title="Discuss a Topic"><i class="fas fa-plus"></i></button>
                            <button id="changePersonaBtn" title="Change AI Persona" style="display: none;"><i class="fa-solid fa-users"></i></button>
                            <button id="send-btn" class="send-btn" title="Send Message"><i class="fas fa-paper-plane"></i></button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Summary Section (Desktop) -->
            <section class="summary-section">
                <div class="summary-header">
                    <h3>Today's Agenda</h3>
                    <button id="copy-summary-btn"><i class="fas fa-copy" style="margin-right: 5px;"></i>Copy</button>
                </div>
                <div class="summary-content" id="summary-content"><h4>Today's Agenda</h4><p>No further meetings or milestones scheduled for today.</p><h4>Tomorrow's First Item: Community Empowerment Briefing (02:00 PM)</h4></div>
            </section>
        </main>

        <!-- Focus Areas Page -->
        <div id="topics-page" class="page-content">
            <div class="topics-container" style="width: 100%;">
                <!-- Topic Card 1 -->
                <div class="topic-card" data-topic-id="labor-market">
                    <div class="topic-icon"><i class="fas fa-briefcase"></i></div>
                    <div class="topic-content">
                        <h3 class="topic-title">Strengthening Labor Market</h3>
                        <p class="topic-description">Developing policies to create an attractive, inclusive, and safe labor market that empowers Saudi nationals and aligns with global standards.</p>
                    </div>
                    <div class="topic-kpis">
                        <div class="kpi-item">
                            <span class="kpi-value">4</span>
                            <span class="kpi-label">Strategic KPIs</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-value">7</span>
                            <span class="kpi-label">Related Initiatives</span>
                        </div>
                    </div>
                    <div class="topic-actions">
                        <button class="topic-action-btn" data-action="meetings"><i class="fas fa-calendar-days"></i> Related Meetings</button>
                        <button class="topic-action-btn" data-action="deeper"><i class="fas fa-magnifying-glass"></i> Dig Deeper</button>
                        <button class="topic-action-btn" data-action="references"><i class="fas fa-file-alt"></i> View References</button>
                    </div>
                </div>
                <!-- Topic Card 2 -->
                <div class="topic-card" data-topic-id="empowerment">
                     <div class="topic-icon"><i class="fas fa-users"></i></div>
                    <div class="topic-content">
                        <h3 class="topic-title">Empowering Society &amp; Individuals</h3>
                        <p class="topic-description">Enhancing social development, empowering individuals and communities, and promoting self-reliance through targeted programs and support.</p>
                    </div>
                     <div class="topic-kpis">
                        <div class="kpi-item">
                            <span class="kpi-value">5</span>
                            <span class="kpi-label">Strategic KPIs</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-value">9</span>
                            <span class="kpi-label">Related Initiatives</span>
                        </div>
                    </div>
                    <div class="topic-actions">
                        <button class="topic-action-btn" data-action="meetings"><i class="fas fa-calendar-days"></i> Related Meetings</button>
                        <button class="topic-action-btn" data-action="deeper"><i class="fas fa-magnifying-glass"></i> Dig Deeper</button>
                        <button class="topic-action-btn" data-action="references"><i class="fas fa-file-alt"></i> View References</button>
                    </div>
                </div>
                <!-- Topic Card 3 -->
                <div class="topic-card" data-topic-id="non-profit">
                     <div class="topic-icon"><i class="fas fa-hand-holding-heart"></i></div>
                    <div class="topic-content">
                        <h3 class="topic-title">Enabling the Non-Profit Sector</h3>
                        <p class="topic-description">Fostering the growth and impact of the non-profit sector to expand its contribution to the economy and social development.</p>
                    </div>
                     <div class="topic-kpis">
                        <div class="kpi-item">
                            <span class="kpi-value">3</span>
                            <span class="kpi-label">Strategic KPIs</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-value">4</span>
                            <span class="kpi-label">Related Initiatives</span>
                        </div>
                    </div>
                    <div class="topic-actions">
                        <button class="topic-action-btn" data-action="meetings"><i class="fas fa-calendar-days"></i> Related Meetings</button>
                        <button class="topic-action-btn" data-action="deeper"><i class="fas fa-magnifying-glass"></i> Dig Deeper</button>
                        <button class="topic-action-btn" data-action="references"><i class="fas fa-file-alt"></i> View References</button>
                    </div>
                </div>
                <!-- Topic Card 4 -->
                <div class="topic-card" data-topic-id="strategic-partnerships">
                     <div class="topic-icon"><i class="fas fa-handshake"></i></div>
                    <div class="topic-content">
                        <h3 class="topic-title">Strategic Partnerships</h3>
                        <p class="topic-description">Building effective and sustainable partnerships with public, private, and non-profit entities to achieve shared national goals.</p>
                    </div>
                     <div class="topic-kpis">
                        <div class="kpi-item">
                            <span class="kpi-value">2</span>
                            <span class="kpi-label">Strategic KPIs</span>
                        </div>
                        <div class="kpi-item">
                            <span class="kpi-value">6</span>
                            <span class="kpi-label">Related Initiatives</span>
                        </div>
                    </div>
                    <div class="topic-actions">
                        <button class="topic-action-btn" data-action="meetings"><i class="fas fa-calendar-days"></i> Related Meetings</button>
                        <button class="topic-action-btn" data-action="deeper"><i class="fas fa-magnifying-glass"></i> Dig Deeper</button>
                        <button class="topic-action-btn" data-action="references"><i class="fas fa-file-alt"></i> View References</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Agenda Page -->
        <div id="agenda-page" class="page-content">
            <div class="agenda-container" style="width: 100%;">
                <!-- Desktop Calendar View -->
                <div class="desktop-calendar">
                    <div class="agenda-header">
                        <h2>October 2025</h2>
                        <div class="view-toggle">
                            <button class="view-btn" data-view="today">Today</button>
                            <button class="view-btn active" data-view="week">Week</button>
                            <button class="view-btn" data-view="month">Month</button>
                        </div>
                    </div>

                    <!-- Today View (Desktop) -->
                    <div id="today-view" class="agenda-view">
                        <div class="today-header">
                            <div class="today-date">Wednesday, October 22, 2025</div>
                        </div>
                        <div class="today-events-list" id="today-events-list"><p style="opacity: 0.7; text-align: center; padding: 20px;">No events scheduled for today.</p></div>
                    </div>

                    <!-- Week View (Desktop) -->
                    <div id="week-view" class="agenda-view active">
                        <div class="calendar-grid">
                            <div class="day-column"><div class="day-header"><div class="day-name">Sun</div><div class="day-number">19</div></div></div>
                            <div class="day-column"><div class="day-header"><div class="day-name">Mon</div><div class="day-number">20</div></div> <div class="event" data-event-title="Labor Market Policy Review" data-event-time="09:00 AM" data-event-details="Strategic sync on new labor market policies to enhance Saudization." data-topic="labor-market" data-date="2025-10-20"> <div class="event-time">09:00 AM</div> <div class="event-title">Labor Market Policy Review</div> </div> <div class="event event-milestone" data-event-title="Milestone: Non-Profit Portal Launch" data-event-time="EOD" data-event-details="Official launch of the new national portal for non-profit organizations. Review launch communications." data-topic="non-profit" data-date="2025-10-20"> <div class="event-time">EOD</div> <div class="event-title">Milestone: Non-Profit Portal Launch</div> </div></div>
                            <div class="day-column"><div class="day-header"><div class="day-name">Tue</div><div class="day-number">21</div></div> <div class="event" data-event-title="Partnership MoU Signing" data-event-time="10:00 AM" data-event-details="Ceremony for signing the Memorandum of Understanding with key private sector partners." data-topic="strategic-partnerships" data-date="2025-10-21"> <div class="event-time">10:00 AM</div> <div class="event-title">Partnership MoU Signing</div> </div></div>
                            <div class="day-column"><div class="day-header"><div class="day-name">Wed</div><div class="day-number">22</div></div></div>
                            <div class="day-column"><div class="day-header"><div class="day-name">Thu</div><div class="day-number">23</div></div> <div class="event" data-event-title="Community Empowerment Briefing" data-event-time="02:00 PM" data-event-details="Briefing on the results of the recent community empowerment programs and future plans." data-topic="empowerment" data-date="2025-10-23"> <div class="event-time">02:00 PM</div> <div class="event-title">Community Empowerment Briefing</div> </div></div>
                            <div class="day-column weekend"><div class="day-header"><div class="day-name">Fri</div><div class="day-number">24</div></div></div>
                            <div class="day-column weekend"><div class="day-header"><div class="day-name">Sat</div><div class="day-number">25</div></div></div>
                        </div>
                    </div>

                    <!-- Month View (Desktop) -->
                    <div id="month-view" class="agenda-view">
                        <div class="month-calendar-grid" id="month-calendar-grid"><div class="month-day-header ">Sun</div><div class="month-day-header ">Mon</div><div class="month-day-header ">Tue</div><div class="month-day-header ">Wed</div><div class="month-day-header ">Thu</div><div class="month-day-header weekend">Fri</div><div class="month-day-header weekend">Sat</div><div class="month-day-cell other-month"></div><div class="month-day-cell other-month"></div><div class="month-day-cell other-month"></div><div class="month-day-cell disabled-day" data-date="2025-10-01"><div class="month-day-number">1</div><div class="month-day-events"></div></div><div class="month-day-cell disabled-day" data-date="2025-10-02"><div class="month-day-number">2</div><div class="month-day-events"></div></div><div class="month-day-cell disabled-day weekend" data-date="2025-10-03"><div class="month-day-number">3</div><div class="month-day-events"></div></div><div class="month-day-cell disabled-day weekend" data-date="2025-10-04"><div class="month-day-number">4</div><div class="month-day-events"></div></div><div class="month-day-cell disabled-day" data-date="2025-10-05"><div class="month-day-number">5</div><div class="month-day-events"></div></div><div class="month-day-cell disabled-day" data-date="2025-10-06"><div class="month-day-number">6</div><div class="month-day-events"></div></div><div class="month-day-cell disabled-day" data-date="2025-10-07"><div class="month-day-number">7</div><div class="month-day-events"></div></div><div class="month-day-cell disabled-day" data-date="2025-10-08"><div class="month-day-number">8</div><div class="month-day-events"></div></div><div class="month-day-cell disabled-day" data-date="2025-10-09"><div class="month-day-number">9</div><div class="month-day-events"></div></div><div class="month-day-cell disabled-day weekend" data-date="2025-10-10"><div class="month-day-number">10</div><div class="month-day-events"></div></div><div class="month-day-cell disabled-day weekend" data-date="2025-10-11"><div class="month-day-number">11</div><div class="month-day-events"></div></div><div class="month-day-cell disabled-day" data-date="2025-10-12"><div class="month-day-number">12</div><div class="month-day-events"></div></div><div class="month-day-cell disabled-day" data-date="2025-10-13"><div class="month-day-number">13</div><div class="month-day-events"></div></div><div class="month-day-cell disabled-day" data-date="2025-10-14"><div class="month-day-number">14</div><div class="month-day-events"></div></div><div class="month-day-cell disabled-day" data-date="2025-10-15"><div class="month-day-number">15</div><div class="month-day-events"></div></div><div class="month-day-cell disabled-day" data-date="2025-10-16"><div class="month-day-number">16</div><div class="month-day-events"></div></div><div class="month-day-cell disabled-day weekend" data-date="2025-10-17"><div class="month-day-number">17</div><div class="month-day-events"></div></div><div class="month-day-cell disabled-day weekend" data-date="2025-10-18"><div class="month-day-number">18</div><div class="month-day-events"></div></div><div class="month-day-cell disabled-day" data-date="2025-10-19"><div class="month-day-number">19</div><div class="month-day-events"></div></div><div class="month-day-cell disabled-day" data-date="2025-10-20"><div class="month-day-number">20</div><div class="month-day-events"><div class="month-event-dot "></div><div class="month-event-dot milestone"></div></div></div><div class="month-day-cell disabled-day" data-date="2025-10-21"><div class="month-day-number">21</div><div class="month-day-events"><div class="month-event-dot "></div></div></div><div class="month-day-cell today" data-date="2025-10-22"><div class="month-day-number">22</div><div class="month-day-events"></div></div><div class="month-day-cell" data-date="2025-10-23"><div class="month-day-number">23</div><div class="month-day-events"><div class="month-event-dot "></div></div></div><div class="month-day-cell weekend" data-date="2025-10-24"><div class="month-day-number">24</div><div class="month-day-events"></div></div><div class="month-day-cell weekend" data-date="2025-10-25"><div class="month-day-number">25</div><div class="month-day-events"></div></div><div class="month-day-cell" data-date="2025-10-26"><div class="month-day-number">26</div><div class="month-day-events"></div></div><div class="month-day-cell" data-date="2025-10-27"><div class="month-day-number">27</div><div class="month-day-events"></div></div><div class="month-day-cell" data-date="2025-10-28"><div class="month-day-number">28</div><div class="month-day-events"></div></div><div class="month-day-cell" data-date="2025-10-29"><div class="month-day-number">29</div><div class="month-day-events"></div></div><div class="month-day-cell" data-date="2025-10-30"><div class="month-day-number">30</div><div class="month-day-events"></div></div><div class="month-day-cell weekend" data-date="2025-10-31"><div class="month-day-number">31</div><div class="month-day-events"></div></div></div>
                    </div>
                </div>
                <!-- Mobile Calendar View -->
                <div class="mobile-calendar">
                     <div class="agenda-header">
                        <h2 id="mobile-calendar-title">October 2025</h2>
                        <div class="view-toggle">
                            <button class="mobile-view-btn" data-view="today">Today</button>
                            <button class="mobile-view-btn active" data-view="week">Week</button>
                            <button class="mobile-view-btn" data-view="month">Month</button>
                        </div>
                    </div>
                    <div id="mobile-month-grid"><div class="day-name">Sun</div><div class="day-name">Mon</div><div class="day-name">Tue</div><div class="day-name">Wed</div><div class="day-name">Thu</div><div class="day-name">Fri</div><div class="day-name">Sat</div><div class="day-cell">19</div><div class="day-cell">20</div><div class="day-cell has-event">21</div><div class="day-cell today has-event">22</div><div class="day-cell selected">23</div><div class="day-cell has-event">24</div><div class="day-cell">25</div></div>
                    <div id="mobile-agenda-events"><p style="opacity: 0.7; text-align: center; padding: 20px;">No events scheduled for this day</p></div>
                </div>
            </div>
        </div>


        <!-- Tools Page -->
        <div id="tools-page" class="page-content">
            <div class="tools-container">
                <!-- Tool Card 1: Data Visualization -->
                <div class="tool-card">
                    <div class="tool-icon"><i class="fas fa-chart-bar"></i></div>
                    <h3 class="tool-title">AI-Powered Data Visualization</h3>
                    <p class="tool-description">Automatically generates insightful charts and dashboards from ministry data, highlighting key trends, anomalies, and performance metrics without manual setup.</p>
                    <button class="tool-action-btn" data-tool-action="visualize"><i class="fas fa-eye"></i> Explore Tool</button>
                </div>
                <!-- Tool Card 2: Predictive Analytics -->
                <div class="tool-card">
                    <div class="tool-icon"><i class="fas fa-brain"></i></div>
                    <h3 class="tool-title">Predictive Policy Modeling</h3>
                    <p class="tool-description">Simulates the potential impact of proposed policies on key indicators (e.g., employment, social welfare) using AI to forecast outcomes and risks.</p>
                    <button class="tool-action-btn" data-tool-action="predict"><i class="fas fa-cogs"></i> Run Simulation</button>
                </div>
                <!-- Tool Card 3: Report Generation -->
                <div class="tool-card">
                    <div class="tool-icon"><i class="fas fa-file-invoice"></i></div>
                    <h3 class="tool-title">Automated Report Synthesis</h3>
                    <p class="tool-description">Condenses lengthy reports, research papers, and meeting transcripts into concise executive summaries, extracting key findings and action items.</p>
                    <button class="tool-action-btn" data-tool-action="summarize"><i class="fas fa-align-left"></i> Generate Summary</button>
                </div>
                 <!-- Tool Card 4: Sentiment Analysis -->
                <div class="tool-card">
                    <div class="tool-icon"><i class="fas fa-comments"></i></div>
                    <h3 class="tool-title">Public Sentiment Analysis</h3>
                    <p class="tool-description">Analyzes social media, news, and public feedback channels to gauge sentiment towards HRSD initiatives and identify emerging public concerns.</p>
                    <button class="tool-action-btn" data-tool-action="sentiment"><i class="fas fa-search"></i> View Sentiment</button>
                </div>
                 <!-- Tool Card 5: Smart Scheduling -->
                 <div class="tool-card">
                    <div class="tool-icon"><i class="fas fa-calendar-check"></i></div>
                    <h3 class="tool-title">Intelligent Meeting Scheduler</h3>
                    <p class="tool-description">Optimizes scheduling for complex, multi-attendee high-level meetings by considering priorities, availability, and optimal time slots using AI.</p>
                    <button class="tool-action-btn" data-tool-action="schedule"><i class="fas fa-calendar-plus"></i> Schedule Meeting</button>
                </div>
                 <!-- Tool Card 6: Risk Assessment -->
                 <div class="tool-card">
                    <div class="tool-icon"><i class="fas fa-shield-alt"></i></div>
                    <h3 class="tool-title">AI Risk Assessment</h3>
                    <p class="tool-description">Identifies potential risks in projects, policies, or operational areas by analyzing historical data and external factors, providing early warnings.</p>
                    <button class="tool-action-btn" data-tool-action="risk"><i class="fas fa-exclamation-triangle"></i> Assess Risk</button>
                </div>
            </div>
        </div>
        <!-- Placeholder Pages -->
        <div id="compose-page" class="page-content"> <div class="placeholder-page" style="width: 100%;"> <h2><i class="fas fa-pen-alt"></i> Compose</h2> <p>Use this section to draft emails, reports, and other documents with AI assistance. The agent can help with tone, clarity, and content generation.</p> </div> </div>
        <div id="templates-page" class="page-content"> <div class="placeholder-page" style="width: 100%;"> <h2><i class="fas fa-file-alt"></i> Templates</h2> <p>Access a library of pre-built templates for various documents, including meeting minutes, project proposals, and executive summaries, to streamline your workflow.</p> </div> </div>
    </div>

    <!-- Modals -->
    <div id="personaModal" class="modal">
        <div class="modal-content">
            <span class="close-button">×</span>
            <h2>Choose Your AI Agent</h2>
            <div class="persona-options" id="personaOptions"></div>
        </div>
    </div>

    <div id="eventModal" class="modal">
        <div class="modal-content">
            <span class="close-button">×</span>
            <h3 id="event-modal-title">Event Title</h3>
            <p id="event-modal-time">Event Time</p>
            <p id="event-modal-details">Event Details</p>
            <div class="event-actions">
                <button id="summarize-event-btn"><i class="fas fa-align-left"></i> Summarize</button>
                <button id="prepare-event-btn"><i class="fas fa-clipboard-check"></i> Consult for Preparation</button>
            </div>
        </div>
    </div>

    <div id="meetingsModal" class="modal" style="display: none;">
        <div class="modal-content" id="focus-modal-content">
            <span class="close-button">×</span>
            <h2 id="meetings-modal-title">Discuss a Topic</h2>
            <div id="meetings-modal-list"></div>
        </div>
    </div>

    <div id="dayActionModal" class="modal">
        <div class="modal-content">
            <span class="close-button">×</span>
            <h2 id="day-action-title">Actions for Date</h2>
            <div id="day-action-focus-areas">
                 <div class="dropdown-header">Select a Focus Area</div>
                 <div class="modal-pills-container" id="day-action-pills">
                     <!-- Pills will be populated by JS -->
                 </div>
            </div>
            <div class="day-actions">
                <button data-action="check"><i class="fas fa-calendar-check"></i> Check Availability</button>
                <button data-action="media"><i class="fas fa-bullhorn"></i> Coordinate with Media Team</button>
                <button data-action="consulting"><i class="fas fa-users-cog"></i> Summon Consulting Team</button>
            </div>
        </div>
    </div>

    <!-- Simple Message Modal (replaces alert) -->
    <div id="messageModal" class="modal">
        <div class="modal-content" style="width: 400px; max-width: 90%;">
            <span class="close-button">×</span>
            <h2 id="message-modal-title" style="color: var(--primary-blue); margin-bottom: 15px;">Notice</h2>
            <p id="message-modal-text" style="text-align: center; font-size: 1.1rem; line-height: 1.6;"></p>
        </div>
    </div>

    <!-- Floating "Ask Agent" Button -->
    <div id="ask-agent-btn" style="display: none;"><i class="fas fa-comment-dots"></i> Ask Agent</div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA ---
            const personaData = [
                { id: 'hakim', name: 'Hakim Nüruddin', title: 'AI Executive Office Agent', largeImg: 'https://hams.ai/images/ai-voice-agent.png', smallImg: 'https://hams.ai/images/ai-voice-agent.png', description: 'As your strategic partner, I provide high-level summaries, executive advice, and focus on strategic alignment for your key decisions.', systemPrompt: 'You are Hakim Nüruddin, an AI Executive Office Agent for HRSD in Saudi Arabia... Be concise, professional, and insightful. Provide strategic advice and summaries.' },
                // Update Layla's systemPrompt for insights/charts
                { id: 'layla', name: 'Layla Al-Farsi', title: 'Data Analytics Agent', largeImg: 'https://easy-peasy.ai/cdn-cgi/image/quality=80,format=auto,width=700/https://media.easy-peasy.ai/27feb2bb-aeb4-4a83-9fb6-8f3f2a15885e/3f6fb035-158b-47f1-8c69-5fe9a407d4f2.png', smallImg: 'https://easy-peasy.ai/cdn-cgi/image/quality=80,format=auto,width=700/https://media.easy-peasy.ai/27feb2bb-aeb4-4a83-9fb6-8f3f2a15885e/3f6fb035-158b-47f1-8c69-5fe9a407d4f2.png', description: 'As your data expert, I provide your Highness with key insights from around HRSD, identify trends, and offer detailed analytical support for your objectives.', systemPrompt: 'You are Layla Al-Farsi, a Data Analytics Agent for HRSD in Saudi Arabia. Your Highness requires data-driven insights. ALWAYS respond with concise analysis, key findings, and data points. When a visualization is appropriate (e.g., trends, comparisons), provide the necessary data in a Chart.js-compatible JSON format strictly enclosed within `[CHART_DATA:{...}]`. The JSON MUST be complete and valid. It MUST contain "type" (e.g., "bar", "line", "pie"), "labels" (array of strings), and "datasets" (array of objects, each with "label" and "data" properties). Example: `[CHART_DATA:{"type": "bar", "labels": ["Q1", "Q2"], "datasets": [{"label": "Metric A", "data": [10, 15]}]}]` Always include a brief textual explanation of the chart\'s insights immediately following the chart data marker. Focus strictly on providing analytical insights derived from data. Avoid conversational filler unless specifically asked.' }, // Added "MUST be complete and valid"
                { id: 'omar', name: 'Omar Mansour', title: 'AI Coordinator', largeImg: 'https://easy-peasy.ai/cdn-cgi/image/quality=80,format=auto,width=700/https://media.easy-peasy.ai/2f8cd8b2-88d5-4865-b07e-cafd6403b72b/bd99faca-67c4-4cc3-895e-06bed59a08d2.png', smallImg: 'https://easy-peasy.ai/cdn-cgi/image/quality=80,format=auto,width=700/https://media.easy-peasy.ai/2f8cd8b2-88d5-4865-b07e-cafd6403b72b/bd99faca-67c4-4cc3-895e-06bed59a08d2.png', description: 'As your operational specialist, I manage schedules, coordinate between departments, and provide logistical support to ensure operational smoothness.', systemPrompt: 'You are Omar Mansour, an AI Coordinator for HRSD... Focus on logistics, scheduling, action items, and ensuring operational smoothness.' }
            ];
            let currentPersonaId = 'hakim';
            let selectedAgents = ['hakim']; // Multi-agent: Array of selected agent IDs
            let isMultiAgentMode = false; // Mode: false = single agent, true = multi-agent
            let chatHistory = [];
            let selectedText = '';
            // Set "today" to the specified context date: Wednesday, Oct 22, 2025
            const today = new Date('2025-10-22T09:23:00+03:00');

            // --- DOM Elements ---
            const mainPersonaImage = document.getElementById('mainPersonaImage');
            const mainPersonaName = document.getElementById('mainPersonaName');
            const mainPersonaTitle = document.getElementById('mainPersonaTitle');
            const personaModal = document.getElementById("personaModal");
            const eventModal = document.getElementById("eventModal");
            const meetingsModal = document.getElementById("meetingsModal");
            const dayActionModal = document.getElementById("dayActionModal");
            const messageModal = document.getElementById("messageModal"); // New modal
            const changePersonaBtn = document.getElementById('changePersonaBtn');
            const closeModalBtns = document.querySelectorAll('.close-button');
            const personaOptionsContainer = document.getElementById('personaOptions');
            const navButtons = document.querySelectorAll('.nav-tabs .nav-button'); // More specific selector
            const pages = document.querySelectorAll('.page-content');
            const chatInput = document.getElementById('chatInput');
            const sendBtn = document.getElementById('send-btn');
            const chatMessages = document.getElementById('chatMessages');
            const askAgentBtn = document.getElementById('ask-agent-btn');
            const summaryContent = document.getElementById('summary-content');
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            const navTabsContainer = document.querySelector('.nav-tabs-container');
            const chatActionBtn = document.getElementById('chat-action-btn');
            const messageModalTitle = document.getElementById("message-modal-title"); // New
            const messageModalText = document.getElementById("message-modal-text"); // New
            const copySummaryBtn = document.getElementById("copy-summary-btn"); // Copy button

            // --- Function Definitions ---

            // --- Persona Management ---
            function updatePersonaUI(personaId, isInitialLoad = false) {
                 const persona = personaData.find(p => p.id === personaId);
                if (!persona) return;

                if(mainPersonaImage) mainPersonaImage.src = persona.largeImg;
                if(mainPersonaName) mainPersonaName.textContent = persona.name;
                if(mainPersonaTitle) mainPersonaTitle.textContent = persona.title;

                document.querySelectorAll('[data-persona-avatar]').forEach(img => {
                    img.src = persona.smallImg;
                });

                const oldPersonaId = currentPersonaId;
                currentPersonaId = personaId;

                if (!isInitialLoad && oldPersonaId !== currentPersonaId) {
                    chatHistory = []; // Reset history when changing persona
                   if (chatMessages) chatMessages.innerHTML = ''; // Add null check
                    displayNewPersonaGreeting(persona);
                }
            }

            function displayNewPersonaGreeting(persona) {
                 let greeting = `Welcome your Highness. As-salāmu 'alaykum. I am ${persona.name}. ${persona.description} How may I be of service to your Highness today?`;
                 displayMessage('agent', greeting);
                 // Add greeting to history for context
                 // Check if history is empty or last message wasn't this greeting to avoid duplicates on quick switches
                 if(chatHistory.length === 0 || chatHistory[chatHistory.length-1]?.parts?.[0]?.text !== greeting) {
                    chatHistory.push({ role: 'model', parts: [{ text: greeting }] });
                 }
            }
            
            // --- Multi-Agent Functions ---
            function renderAgentSelection() {
                const container = document.getElementById('agentSelectionList');
                if (!container) return;
                
                container.innerHTML = '';
                personaData.forEach(agent => {
                    const isSelected = selectedAgents.includes(agent.id);
                    const div = document.createElement('div');
                    div.className = `agent-select-item ${isSelected ? 'selected' : ''}`;
                    
                    // Create unique ID for checkbox-label association
                    const toggleId = `agent-toggle-${agent.id}`;
                    
                    div.innerHTML = `
                        <input type="checkbox" class="agent-checkbox" 
                               id="${toggleId}"
                               data-agent-id="${agent.id}" 
                               ${isSelected ? 'checked' : ''}>
                        <label for="${toggleId}" class="agent-toggle">
                            <span class="agent-toggle-slider"></span>
                        </label>
                        <img src="${agent.smallImg}" alt="${agent.name}" class="agent-mini-avatar">
                        <div class="agent-select-info">
                            <div class="agent-select-name">${agent.name}</div>
                            <div class="agent-select-title">${agent.title}</div>
                        </div>
                    `;
                    
                    // Handle checkbox change
                    const checkbox = div.querySelector('.agent-checkbox');
                    checkbox.addEventListener('change', (e) => {
                        e.stopPropagation();
                        toggleAgentSelection(agent.id);
                    });
                    
                    // Handle div click (toggle when clicking anywhere on the card except the toggle itself)
                    div.addEventListener('click', (e) => {
                        // Don't toggle if clicking directly on the toggle switch or checkbox
                        if (!e.target.closest('.agent-toggle') && e.target !== checkbox) {
                            checkbox.checked = !checkbox.checked;
                            toggleAgentSelection(agent.id);
                        }
                    });
                    
                    container.appendChild(div);
                });
                
                // Update the count badge
                const countBadge = document.getElementById('agentCountBadge');
                if (countBadge) {
                    countBadge.textContent = selectedAgents.length;
                }
            }
            
            function toggleAgentSelection(agentId) {
                const index = selectedAgents.indexOf(agentId);
                if (index > -1) {
                    // Deselect - but ensure at least one agent is selected
                    if (selectedAgents.length > 1) {
                        selectedAgents.splice(index, 1);
                    } else {
                        showMessageModal('At least one agent must be selected', 'Notice');
                        renderAgentSelection(); // Re-render to reset the checkbox
                        return;
                    }
                } else {
                    // Select
                    selectedAgents.push(agentId);
                }
                renderAgentSelection();
            }
            
            function getSelectedAgentsInfo() {
                return selectedAgents.map(id => personaData.find(p => p.id === id)).filter(Boolean);
            }
            
            // --- Mode Toggle Functions ---
            function toggleMode(multiMode) {
                isMultiAgentMode = multiMode;
                
                const singleAgentDisplay = document.getElementById('singleAgentDisplay');
                const multiAgentContent = document.getElementById('multiAgentContent');
                const agentSelectorBtn = document.getElementById('agentSelectorBtn');
                const singleModeLabel = document.getElementById('singleModeLabel');
                const multiModeLabel = document.getElementById('multiModeLabel');
                const changePersonaBtn = document.getElementById('changePersonaBtn');
                
                if (isMultiAgentMode) {
                    // Multi-agent mode
                    if (singleAgentDisplay) singleAgentDisplay.classList.remove('active');
                    if (multiAgentContent) multiAgentContent.classList.remove('hidden');
                    if (agentSelectorBtn) agentSelectorBtn.classList.remove('active');
                    if (singleModeLabel) singleModeLabel.classList.remove('active');
                    if (multiModeLabel) multiModeLabel.classList.add('active');
                    if (changePersonaBtn) changePersonaBtn.style.display = 'none'; // Hide change persona in multi mode
                } else {
                    // Single agent mode
                    if (singleAgentDisplay) singleAgentDisplay.classList.add('active');
                    if (multiAgentContent) multiAgentContent.classList.add('hidden');
                    if (agentSelectorBtn) agentSelectorBtn.classList.add('active');
                    if (singleModeLabel) singleModeLabel.classList.add('active');
                    if (multiModeLabel) multiModeLabel.classList.remove('active');
                    if (changePersonaBtn) changePersonaBtn.style.display = 'block'; // Show change persona in single mode
                    
                    // Update single agent display
                    updateSingleAgentDisplay(currentPersonaId);
                }
            }
            
            function updateSingleAgentDisplay(agentId) {
                const agent = personaData.find(p => p.id === agentId);
                if (!agent) return;
                
                const avatar = document.getElementById('singleAgentAvatar');
                const name = document.getElementById('singleAgentName');
                const title = document.getElementById('singleAgentTitle');
                const description = document.getElementById('singleAgentDescription');
                const selectorBtn = document.getElementById('agentSelectorBtn');
                
                if (avatar) avatar.src = agent.largeImg;
                if (name) name.textContent = agent.name;
                if (title) title.textContent = agent.title;
                if (description) description.textContent = agent.description;
                
                // Update selector button - only avatar and chevron, no name
                if (selectorBtn) {
                    const btnImg = selectorBtn.querySelector('img');
                    if (btnImg) btnImg.src = agent.smallImg;
                    // Remove name span if exists, keep only img and chevron icon
                    const spans = selectorBtn.querySelectorAll('span');
                    spans.forEach(span => span.remove());
                }
            }
            
            function showAgentSelectorMenu() {
                // Create dropdown menu
                const existingMenu = document.getElementById('agentSelectorMenu');
                if (existingMenu) {
                    existingMenu.remove();
                    return;
                }
                
                const menu = document.createElement('div');
                menu.id = 'agentSelectorMenu';
                menu.style.cssText = `
                    position: absolute;
                    bottom: calc(100% + 8px);
                    left: 0;
                    background: var(--container-bg);
                    backdrop-filter: blur(30px);
                    border: 2px solid var(--primary-blue);
                    border-radius: 14px;
                    padding: 8px;
                    box-shadow: 0 -8px 30px rgba(0, 169, 157, 0.4);
                    z-index: 1000;
                    min-width: 220px;
                    animation: slideUpFadeIn 0.3s ease;
                `;
                
                // Add animation keyframes
                if (!document.getElementById('agentMenuAnimation')) {
                    const style = document.createElement('style');
                    style.id = 'agentMenuAnimation';
                    style.textContent = `
                        @keyframes slideUpFadeIn {
                            from {
                                opacity: 0;
                                transform: translateY(10px);
                            }
                            to {
                                opacity: 1;
                                transform: translateY(0);
                            }
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                personaData.forEach(agent => {
                    const item = document.createElement('div');
                    const isSelected = agent.id === currentPersonaId;
                    item.style.cssText = `
                        display: flex;
                        align-items: center;
                        gap: 10px;
                        padding: 10px;
                        margin: 4px 0;
                        border-radius: 10px;
                        cursor: pointer;
                        transition: all 0.2s ease;
                        ${isSelected ? 
                            'background: linear-gradient(135deg, rgba(0, 169, 157, 0.25), rgba(0, 169, 157, 0.35)); border: 2px solid var(--primary-blue);' : 
                            'border: 2px solid transparent; background: rgba(255, 255, 255, 0.05);'}
                    `;
                    
                    item.innerHTML = `
                        <img src="${agent.smallImg}" 
                             style="width: 36px; height: 36px; border-radius: 50%; border: 2px solid ${isSelected ? 'var(--primary-blue)' : 'var(--border-color)'}; box-shadow: 0 2px 8px rgba(0, 169, 157, 0.3);" 
                             alt="${agent.name}">
                        <div style="flex: 1;">
                            <div style="font-weight: 600; font-size: 0.9rem; color: var(--text-dark);">${agent.name}</div>
                            <div style="font-size: 0.75rem; opacity: 0.7; color: var(--text-light);">${agent.title}</div>
                        </div>
                        ${isSelected ? '<i class="fas fa-check" style="color: var(--primary-blue); font-size: 1rem;"></i>' : ''}
                    `;
                    
                    item.addEventListener('mouseenter', () => {
                        if (agent.id !== currentPersonaId) {
                            item.style.background = 'linear-gradient(135deg, rgba(0, 169, 157, 0.15), rgba(0, 169, 157, 0.25))';
                            item.style.borderColor = 'rgba(0, 169, 157, 0.5)';
                            item.style.transform = 'translateX(3px)';
                        }
                    });
                    
                    item.addEventListener('mouseleave', () => {
                        if (agent.id !== currentPersonaId) {
                            item.style.background = 'rgba(255, 255, 255, 0.05)';
                            item.style.borderColor = 'transparent';
                            item.style.transform = 'translateX(0)';
                        }
                    });
                    
                    item.addEventListener('click', () => {
                        updatePersonaUI(agent.id);
                        updateSingleAgentDisplay(agent.id);
                        menu.style.animation = 'slideUpFadeIn 0.2s ease reverse';
                        setTimeout(() => menu.remove(), 200);
                    });
                    
                    menu.appendChild(item);
                });
                
                const selectorBtn = document.getElementById('agentSelectorBtn');
                if (selectorBtn) {
                    selectorBtn.style.position = 'relative';
                    selectorBtn.appendChild(menu);
                }
                
                // Close menu when clicking outside
                setTimeout(() => {
                    document.addEventListener('click', function closeMenu(e) {
                        if (!menu.contains(e.target) && e.target.id !== 'agentSelectorBtn' && !e.target.closest('#agentSelectorBtn')) {
                            menu.style.animation = 'slideUpFadeIn 0.2s ease reverse';
                            setTimeout(() => menu.remove(), 200);
                            document.removeEventListener('click', closeMenu);
                        }
                    });
                }, 100);
            }

            function renderPersonaOptions() {
                 if (!personaOptionsContainer) return;
                personaOptionsContainer.innerHTML = '';
                personaData.forEach(persona => {
                    const div = document.createElement('div');
                    div.className = `persona-option ${persona.id === currentPersonaId ? 'selected' : ''}`;
                    div.innerHTML = `
                        <img src="${persona.smallImg}" alt="${persona.name}">
                        <div class="persona-details">
                            <h4>${persona.name} - ${persona.title}</h4>
                            <p>${persona.description}</p>
                        </div>
                    `;

                    div.addEventListener('click', () => {
                        updatePersonaUI(persona.id);
                        closeModal(personaModal);
                    });
                    personaOptionsContainer.appendChild(div);
                });
            }

            // --- Modal Management ---
            function openModal(modal) {
                 if (!modal) return;
                 if (modal === personaModal) renderPersonaOptions();
                 modal.style.display = "flex";
            }
            function closeModal(modal) {
                 if (!modal) return;
                modal.style.display = "none";
            }

            // Simple message modal
            function showMessageModal(text, title = 'Notice') {
                if(messageModalTitle) messageModalTitle.textContent = title;
                if(messageModalText) messageModalText.textContent = text;
                if(messageModal) openModal(messageModal);
            }

            // --- Agenda & Calendar ---
             function setupAgendaInteractions() {
                 document.querySelectorAll('.event').forEach(eventEl => {
                     eventEl.addEventListener('click', () => {
                         const title = eventEl.dataset.eventTitle;
                         const time = eventEl.dataset.eventTime;
                         const details = eventEl.dataset.eventDetails;
                         openEventModal(title, time, details);
                     });
                 });
             }

            function openEventModal(title, time, details) {
                 const titleEl = document.getElementById('event-modal-title');
                const timeEl = document.getElementById('event-modal-time');
                const detailsEl = document.getElementById('event-modal-details');

                if (titleEl) titleEl.textContent = title;
                if (timeEl) timeEl.textContent = time;
                if (detailsEl) detailsEl.textContent = details;

                const summarizeBtn = document.getElementById('summarize-event-btn');
                const prepareBtn = document.getElementById('prepare-event-btn');

                if (!summarizeBtn || !prepareBtn) return;

                // Clone and replace buttons to remove old event listeners
                const newSummarizeBtn = summarizeBtn.cloneNode(true);
                summarizeBtn.parentNode.replaceChild(newSummarizeBtn, summarizeBtn);
                const newPrepareBtn = prepareBtn.cloneNode(true);
                prepareBtn.parentNode.replaceChild(newPrepareBtn, prepareBtn);

                newSummarizeBtn.addEventListener('click', () => {
                    const prompt = `Please provide a brief summary for my upcoming event: "${title}".`;
                    switchToAgentAndSendPrompt(prompt);
                });
                newPrepareBtn.addEventListener('click', () => {
                    const prompt = `What preparations do I need for my event: "${title}"? Please consult and advise.`;
                    switchToAgentAndSendPrompt(prompt);
                });

                openModal(eventModal);
            }

            function switchToAgentAndSendPrompt(prompt, targetPersonaId = null) {
                closeModal(eventModal);
                closeModal(dayActionModal);
                closeModal(meetingsModal);

                // Switch persona if specified
                if (targetPersonaId && targetPersonaId !== currentPersonaId) {
                    updatePersonaUI(targetPersonaId); // This will reset history and show greeting
                }

                const agentButton = document.querySelector('.nav-button[data-target="agent-page"]');
                if (agentButton && !agentButton.classList.contains('active')) { // Only click if not already active
                    agentButton.click();
                }

                if (chatInput) {
                    chatInput.value = prompt;
                    // Need a slight delay if persona just switched, otherwise greeting might overlap
                    if (targetPersonaId) {
                         setTimeout(handleSendMessage, 100); // Small delay
                    } else {
                        handleSendMessage();
                    }
                }
            }


            function openMeetingsModal(topicId, topicTitle) {
                const list = document.getElementById('meetings-modal-list');
                const title = document.getElementById('meetings-modal-title');
                if (!list || !title) return;

                list.innerHTML = '';
                title.textContent = `Meetings Related to "${topicTitle}"`;

                const relatedEvents = document.querySelectorAll(`.event[data-topic="${topicId}"]`);

                if (relatedEvents.length > 0) {
                    relatedEvents.forEach(eventEl => {
                        const item = document.createElement('div');
                        item.className = 'meeting-item';
                        item.innerHTML = `
                            <div class="meeting-title">${eventEl.dataset.eventTitle}</div>
                            <div class="meeting-time">${eventEl.dataset.eventTime}</div>
                        `;
                        // Add click handler to discuss this specific meeting
                        item.addEventListener('click', () => {
                             const prompt = `Let's discuss my meeting: "${eventEl.dataset.eventTitle}". Please provide a summary and key objectives.`;
                             switchToAgentAndSendPrompt(prompt);
                        });
                        list.appendChild(item);
                    });
                } else {
                    list.innerHTML = '<p>No scheduled meetings for this topic.</p>';
                }

                openModal(meetingsModal);
            }

            function takeActionFromTopic(prompt) {
                 closeModal(meetingsModal);
                const agentButton = document.querySelector('.nav-button[data-target="agent-page"]');
                if (agentButton) agentButton.click();

                if (chatInput) {
                    chatInput.value = prompt;
                    handleSendMessage();
                }
            }

            // --- Chat & Gemini API ---
            function displayMessage(sender, text, agentId = null) {
                if (!chatMessages) {
                    console.error("chatMessages element not found.");
                    return;
                }
                
                // Use provided agentId or fall back to currentPersonaId
                const personaId = agentId || currentPersonaId;
                const persona = personaData.find(p => p.id === personaId);
                const avatarSrc = sender === 'user'
                    ? 'https://placehold.co/40x40/28a745/ffffff?text=A'
                    : (persona ? persona.smallImg : 'https://placehold.co/40x40/00A99D/ffffff?text=AI');

                const messageBubble = document.createElement('div');
                messageBubble.className = `message-bubble ${sender}`;

                // Create and append avatar image
                const avatarImg = document.createElement('img');
                avatarImg.src = avatarSrc;
                avatarImg.alt = `${sender} Avatar`;
                avatarImg.className = 'avatar';
                if (sender === 'agent') {
                    avatarImg.setAttribute('data-persona-avatar', '');
                }
                messageBubble.appendChild(avatarImg); // Append image first

                const contentDiv = document.createElement('div');
                contentDiv.className = 'content';
                
                // Add agent name tag only in multi-agent mode
                if (sender === 'agent' && isMultiAgentMode && persona) {
                    const agentTag = document.createElement('span');
                    agentTag.className = 'agent-name-tag';
                    agentTag.textContent = persona.name;
                    contentDiv.appendChild(agentTag);
                }

                let chartData = null;
                let textContent = text; // Keep original text by default
                let canvasId = null;
                const chartMarkerStart = '[CHART_DATA:';
                const chartMarkerEnd = ']';

                // Check for chart data marker if it's an agent message
                if (sender === 'agent') {
                    const startIndex = text.indexOf(chartMarkerStart);
                    const endIndex = text.lastIndexOf(chartMarkerEnd); // Find the last closing bracket

                    // Ensure both markers are found and the end is after the start
                    if (startIndex !== -1 && endIndex > startIndex) {
                        const jsonString = text.substring(startIndex + chartMarkerStart.length, endIndex).trim();
                        if (jsonString.startsWith('{') && jsonString.endsWith('}')) {
                            try {
                                chartData = JSON.parse(jsonString);
                                if (chartData.type && chartData.labels && chartData.datasets) {
                                    textContent = text.substring(0, startIndex).trim() + text.substring(endIndex + chartMarkerEnd.length).trim();
                                    canvasId = `chart-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                                    const chartContainer = document.createElement('div');
                                    chartContainer.className = 'chart-container';
                                    chartContainer.innerHTML = `<canvas id="${canvasId}"></canvas>`;
                                    contentDiv.appendChild(chartContainer);
                                } else {
                                     console.error("Parsed chart JSON is missing required properties (type, labels, datasets).", chartData);
                                     chartData = null;
                                     textContent = text;
                                }
                            } catch (e) {
                                console.error("Failed to parse chart JSON:", e, "JSON string:", jsonString);
                                textContent = text;
                                chartData = null;
                            }
                        } else {
                             console.warn("Potential chart data found but doesn't appear to be valid JSON object:", jsonString);
                             textContent = text;
                             chartData = null;
                        }
                    }

                    // Render textContent as Markdown
                    if (textContent && typeof marked !== 'undefined' && marked.parse) {
                        try {
                             const textDiv = document.createElement('div');
                             textDiv.innerHTML = marked.parse(textContent);
                             contentDiv.appendChild(textDiv); // Changed from insertBefore
                        } catch (e) {
                            console.error("Markdown parsing error:", e);
                            const textDiv = document.createElement('div');
                            textDiv.textContent = textContent;
                            contentDiv.appendChild(textDiv);
                        }
                    } else if (textContent) {
                         const textDiv = document.createElement('div');
                         textDiv.textContent = textContent;
                         contentDiv.appendChild(textDiv);
                    }
                } else {
                    // User message - simple text
                    contentDiv.textContent = textContent;
                }

                 // Append contentDiv to messageBubble
                 messageBubble.appendChild(contentDiv);

                 // Append the complete bubble to chatMessages
                if (chatMessages) { // Ensure chatMessages exists
                    chatMessages.appendChild(messageBubble); // Error might have happened here if messageBubble was invalid

                    // Scroll logic and chart rendering timeout remain the same
                    if (chartData && canvasId && sender === 'agent') {
                         setTimeout(() => {
                            const canvasElement = document.getElementById(canvasId);
                            if (canvasElement) { renderChart(canvasElement, chartData); }
                            else { console.error(`Canvas element with ID ${canvasId} not found.`); }
                            setTimeout(() => chatMessages.scrollTop = chatMessages.scrollHeight, 100);
                         }, 0);
                    } else {
                        setTimeout(() => chatMessages.scrollTop = chatMessages.scrollHeight, 0);
                    }
                } else {
                    console.error("chatMessages element not found when trying to append message.");
                }
            }


            // Function to render chart using Chart.js
             function renderChart(canvasElement, chartData) {
                 if (!canvasElement || !chartData || !chartData.type || !chartData.labels || !chartData.datasets) {
                     console.error("Invalid chart data or canvas element provided for rendering.");
                     if (canvasElement && canvasElement.parentElement) {
                        canvasElement.parentElement.innerHTML = "<p style='color: #ffcccc; padding: 10px;'>Could not render chart: Invalid data format.</p>";
                     }
                     return;
                 }
                 
                 // Check if Chart.js is available
                 if (typeof Chart === 'undefined') {
                     console.error("Chart.js library is not loaded.");
                     if (canvasElement && canvasElement.parentElement) {
                        canvasElement.parentElement.innerHTML = "<p style='color: #ffcccc; padding: 10px;'>Chart library not available.</p>";
                     }
                     return;
                 }
                 
                 const ctx = canvasElement.getContext('2d');
                 if (!ctx) {
                     console.error("Could not get canvas context.");
                      if (canvasElement && canvasElement.parentElement) {
                        canvasElement.parentElement.innerHTML = "<p style='color: #ffcccc; padding: 10px;'>Canvas error.</p>";
                     }
                     return;
                 }

                 // Chart types that don't use scales
                 const noScaleTypes = ['pie', 'doughnut', 'polarArea'];
                 const useScales = !noScaleTypes.includes(chartData.type);

                 // Basic Chart.js options
                 const options = {
                     responsive: true,
                     maintainAspectRatio: true,
                     plugins: {
                         legend: {
                             labels: {
                                 color: 'rgba(255, 255, 255, 0.8)'
                             }
                         }
                     }
                 };
                 
                 // Only add scales for chart types that support them
                 if (useScales) {
                     options.scales = {
                         y: {
                             beginAtZero: true,
                             ticks: { color: 'rgba(255, 255, 255, 0.7)' },
                             grid: { color: 'rgba(255, 255, 255, 0.1)' }
                         },
                         x: {
                             ticks: { color: 'rgba(255, 255, 255, 0.7)' },
                             grid: { color: 'rgba(255, 255, 255, 0.1)' }
                         }
                     };
                 }

                 // Default colors if not provided by AI
                 const defaultBackgroundColors = [
                     'rgba(0, 169, 157, 0.6)', 'rgba(255, 193, 7, 0.6)', 'rgba(0, 123, 255, 0.6)',
                     'rgba(220, 53, 69, 0.6)', 'rgba(40, 167, 69, 0.6)', 'rgba(23, 162, 184, 0.6)'
                    ];
                 const defaultBorderColors = [
                      'rgba(0, 169, 157, 1)', 'rgba(255, 193, 7, 1)', 'rgba(0, 123, 255, 1)',
                      'rgba(220, 53, 69, 1)', 'rgba(40, 167, 69, 1)', 'rgba(23, 162, 184, 1)'
                    ];

                 // Ensure datasets have colors and valid data
                 chartData.datasets.forEach((dataset, index) => {
                    if (!Array.isArray(dataset.data)) {
                        console.warn(`Dataset ${index} has invalid or missing 'data' array.`);
                        dataset.data = [];
                    }
                    
                    if (dataset.data.length > 0) {
                        if (!dataset.backgroundColor) {
                            if (chartData.type === 'line' || chartData.type === 'radar') {
                                dataset.backgroundColor = defaultBackgroundColors[index % defaultBackgroundColors.length].replace('0.6', '0.2');
                                dataset.borderColor = defaultBorderColors[index % defaultBorderColors.length];
                                dataset.borderWidth = 2;
                                dataset.fill = true;
                            } else {
                                dataset.backgroundColor = dataset.data.map((_, i) => defaultBackgroundColors[i % defaultBackgroundColors.length]);
                                dataset.borderColor = dataset.data.map((_, i) => defaultBorderColors[i % defaultBorderColors.length]);
                                dataset.borderWidth = 1;
                            }
                        }
                    }
                 });

                 try {
                     new Chart(ctx, {
                         type: chartData.type,
                         data: {
                             labels: chartData.labels,
                             datasets: chartData.datasets
                         },
                         options: options
                     });
                 } catch (e) {
                     console.error("Chart.js rendering error:", e);
                     console.error("Chart data:", chartData);
                     canvasElement.parentElement.innerHTML = `<p style='color: #ffcccc; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px;'>⚠️ Chart rendering failed: ${e.message || 'Unknown error'}</p>`;
                 }
            }


            function showTypingIndicator() {
                if (!chatMessages) return;
                removeTypingIndicator(); // Ensure only one indicator

                const typingBubble = document.createElement('div');
                typingBubble.id = 'typing-indicator';
                typingBubble.className = 'message-bubble agent';
                 const persona = personaData.find(p => p.id === currentPersonaId);
                 const avatarSrc = persona ? persona.smallImg : 'https://placehold.co/40x40/00A99D/ffffff?text=AI'; // Fallback

                typingBubble.innerHTML = `
                    <img src="${avatarSrc}" alt="Agent Avatar" class="avatar" data-persona-avatar>
                    <div class="content">
                       <div class="typing-indicator">
                            <span></span><span></span><span></span>
                       </div>
                    </div>
                `;
                chatMessages.appendChild(typingBubble);
                 setTimeout(() => chatMessages.scrollTop = chatMessages.scrollHeight, 0);
            }

            function removeTypingIndicator() {
                const indicator = document.getElementById('typing-indicator');
                if (indicator) indicator.remove();
            }

            async function handleSendMessage() {
                if (!chatInput) return;
                const userMessage = chatInput.value.trim();
                if (!userMessage) return;

                displayMessage('user', userMessage);
                // Add user message to history *before* calling API
                chatHistory.push({ role: 'user', parts: [{ text: userMessage }] });
                chatInput.value = '';
                
                if (isMultiAgentMode) {
                    // Multi-agent mode: Hakim orchestrates and routes to appropriate agents
                    await orchestrateMultiAgentResponse(userMessage);
                } else {
                    // Single agent mode: send to current persona only
                    showTypingIndicator();
                    await sendMessageToAgent(userMessage, currentPersonaId);
                }
            }
            
            // Smart agent orchestration: Hakim analyzes prompt and routes to appropriate agents
            async function orchestrateMultiAgentResponse(userMessage) {
                const agents = getSelectedAgentsInfo();
                
                // If only one agent selected, just send to that agent
                if (agents.length === 1) {
                    showTypingIndicator();
                    await sendMessageToAgent(userMessage, agents[0].id);
                    return;
                }
                
                // Multi-agent orchestration: Hakim decides who should respond
                const orchestrationPrompt = `You are Hakim Nüruddin, the AI Executive Office Agent coordinating a team of specialists. Analyze this user request and determine which agents should respond:

User Request: "${userMessage}"

Available Agents:
${agents.map(a => `- ${a.name} (${a.id}): ${a.title}`).join('\n')}

Agent Specializations:
- Hakim (hakim): Strategic insights, executive summaries, high-level decisions, leadership advice
- Layla (layla): Data analysis, charts, statistics, metrics, trends, quantitative insights
- Omar (omar): Operational coordination, task management, scheduling, workflow optimization

Instructions:
1. Analyze the user's request carefully
2. Determine which agent(s) are MOST appropriate to answer
3. Respond with ONLY a JSON object in this format:
{
  "agents": ["agent_id1", "agent_id2"],
  "reasoning": "Brief explanation of why these agents"
}

Rules:
- Include Hakim if the query needs strategic/executive perspective
- Include Layla if the query needs data analysis, charts, or metrics
- Include Omar if the query needs operational/task coordination
- Can include 1, 2, or all 3 agents depending on the request
- Choose agents that add unique value, not redundant perspectives

RESPOND ONLY WITH VALID JSON. NO OTHER TEXT.`;

                try {
                    showTypingIndicator();
                    
                    // Send orchestration request to Hakim
                    const orchestrationResponse = await sendOrchestrationRequest(orchestrationPrompt);
                    removeTypingIndicator();
                    
                    if (!orchestrationResponse) {
                        // Fallback: use all selected agents
                        console.warn("Orchestration failed, using all selected agents");
                        for (let i = 0; i < agents.length; i++) {
                            showTypingIndicator();
                            if (i > 0) await new Promise(resolve => setTimeout(resolve, 500));
                            await sendMessageToAgent(userMessage, agents[i].id);
                        }
                        return;
                    }
                    
                    // Parse orchestration response
                    let routingDecision;
                    try {
                        let jsonText = orchestrationResponse.trim();
                        // Remove markdown code blocks if present
                        jsonText = jsonText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                        routingDecision = JSON.parse(jsonText);
                    } catch (e) {
                        console.error("Failed to parse orchestration JSON:", e, orchestrationResponse);
                        // Fallback: use all selected agents
                        for (let i = 0; i < agents.length; i++) {
                            showTypingIndicator();
                            if (i > 0) await new Promise(resolve => setTimeout(resolve, 500));
                            await sendMessageToAgent(userMessage, agents[i].id);
                        }
                        return;
                    }
                    
                    // Show orchestration decision (optional - can be removed for cleaner UX)
                    const orchestrationNote = document.createElement('div');
                    orchestrationNote.className = 'agent-discussion-indicator';
                    orchestrationNote.style.fontSize = '0.85rem';
                    orchestrationNote.style.opacity = '0.8';
                    orchestrationNote.innerHTML = `<i class="fas fa-route"></i> Hakim routing to: ${routingDecision.agents.map(id => {
                        const agent = personaData.find(p => p.id === id);
                        return agent ? agent.name.split(' ')[0] : id;
                    }).join(', ')}`;
                    if (chatMessages) {
                        chatMessages.appendChild(orchestrationNote);
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }
                    
                    // Send to selected agents
                    const selectedAgentIds = routingDecision.agents.filter(id => 
                        agents.some(a => a.id === id)
                    );
                    
                    if (selectedAgentIds.length === 0) {
                        // Fallback if no valid agents selected
                        selectedAgentIds.push(agents[0].id);
                    }
                    
                    for (let i = 0; i < selectedAgentIds.length; i++) {
                        showTypingIndicator();
                        if (i > 0) await new Promise(resolve => setTimeout(resolve, 500));
                        await sendMessageToAgent(userMessage, selectedAgentIds[i]);
                    }
                    
                } catch (error) {
                    console.error("Orchestration error:", error);
                    removeTypingIndicator();
                    // Fallback: send to all selected agents
                    for (let i = 0; i < agents.length; i++) {
                        showTypingIndicator();
                        if (i > 0) await new Promise(resolve => setTimeout(resolve, 500));
                        await sendMessageToAgent(userMessage, agents[i].id);
                    }
                }
            }
            
            // Special function for orchestration requests (no display, just return response)
            async function sendOrchestrationRequest(prompt, retries = 2) {
                const apiKey = "AIzaSyAJGvnZX6uuTlAnf_m0hCQFJ3knsJRnGIU";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{ role: 'user', parts: [{ text: prompt }] }],
                    systemInstruction: {
                        parts: [{ text: 'You are an AI orchestrator. Respond ONLY with valid JSON. No explanations, no markdown, no extra text.' }]
                    },
                    generationConfig: {
                        maxOutputTokens: 512,
                        temperature: 0.3, // Lower temperature for more deterministic routing
                    }
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 && retries > 0) {
                            await new Promise(resolve => setTimeout(resolve, 1000));
                            return sendOrchestrationRequest(prompt, retries - 1);
                        }
                        throw new Error(`API error: ${response.status}`);
                    }

                    const result = await response.json();
                    const responseText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    return responseText || null;
                    
                } catch (error) {
                    console.error("Orchestration request error:", error);
                    return null;
                }
            }
            
            async function sendMessageToAgent(message, agentId, retries = 3, delay = 1000) {
                const apiKey = "AIzaSyAJGvnZX6uuTlAnf_m0hCQFJ3knsJRnGIU";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

                const persona = personaData.find(p => p.id === agentId);
                const systemPromptText = persona ? persona.systemPrompt : 'You are a helpful assistant.';

                // Send the current, complete history
                const payload = {
                    contents: chatHistory,
                    systemInstruction: {
                        parts: [{ text: `${systemPromptText} Your user is a high-level executive ("Your Highness"). The current date and time is ${new Date().toLocaleString('en-US', { timeZone: 'Asia/Riyadh' })}.` }]
                    },
                    generationConfig: {
                        maxOutputTokens: 8192,
                    },
                    safetySettings: [
                        { category: 'HARM_CATEGORY_HARASSMENT', threshold: 'BLOCK_MEDIUM_AND_ABOVE' },
                        { category: 'HARM_CATEGORY_HATE_SPEECH', threshold: 'BLOCK_MEDIUM_AND_ABOVE' },
                        { category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT', threshold: 'BLOCK_MEDIUM_AND_ABOVE' },
                        { category: 'HARM_CATEGORY_DANGEROUS_CONTENT', threshold: 'BLOCK_MEDIUM_AND_ABOVE' },
                    ]
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    removeTypingIndicator();

                    if (!response.ok) {
                        if (!(response.status === 429 || response.status >= 500)) {
                           console.error(`API Error: ${response.status} ${response.statusText}`, await response.text());
                        }
                        if ((response.status === 429 || response.status >= 500) && retries > 0) {
                            await new Promise(resolve => setTimeout(resolve, delay));
                            return sendMessageToAgent(message, agentId, retries - 1, delay * 2);
                        }
                        throw new Error(`API error: ${response.status} ${response.statusText}`);
                    }

                    const result = await response.json();
                    const candidate = result.candidates?.[0];
                    const agentResponseText = candidate?.content?.parts?.[0]?.text;

                    if (agentResponseText) {
                        displayMessage('agent', agentResponseText, agentId);
                        // Add successful AI response to history
                        chatHistory.push({ role: 'model', parts: [{ text: agentResponseText }] });
                    } else {
                        let errorText = "I apologize, but I couldn't process that request fully. Please try rephrasing.";
                        if (candidate && candidate.finishReason && candidate.finishReason !== 'STOP') {
                            errorText = `I'm sorry, my response was stopped due to: ${candidate.finishReason.toLowerCase().replace(/_/g, ' ')}.`;
                            console.warn("Gemini finishReason:", candidate.finishReason, candidate.safetyRatings);
                        } else if (result.promptFeedback && result.promptFeedback.blockReason) {
                            errorText = `I'm sorry, your prompt could not be processed due to: ${result.promptFeedback.blockReason.toLowerCase().replace(/_/g, ' ')}.`;
                            console.warn("Gemini promptFeedback:", result.promptFeedback);
                        } else if (!agentResponseText) {
                            console.warn("Gemini response missing text content:", result);
                            errorText = "I received an empty response. Could you please try asking in a different way?";
                        }
                        displayMessage('agent', errorText, agentId);
                    }
                } catch (error) {
                    console.error('Error fetching from Gemini API:', error.message);
                    removeTypingIndicator();
                    displayMessage('agent', "I'm experiencing network difficulties connecting to my services. Please check your connection or try again shortly.", agentId);
                }
            }
            
            async function startAgentDiscussion() {
                if (selectedAgents.length < 2) {
                    showMessageModal('Please select at least 2 agents to start a discussion', 'Notice');
                    return;
                }
                
                const agents = getSelectedAgentsInfo();
                const agentNames = agents.map(a => a.name).join(', ');
                
                // Show discussion start indicator
                const indicatorDiv = document.createElement('div');
                indicatorDiv.className = 'agent-discussion-indicator';
                indicatorDiv.textContent = `🔄 Agent discussion starting between: ${agentNames}`;
                if (chatMessages) {
                    chatMessages.appendChild(indicatorDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
                
                // Store original history
                const originalHistory = [...chatHistory];
                
                // Create discussion-specific history
                const discussionHistory = [];
                const discussionContext = `Your Highness has requested a collaborative discussion among the AI agents about today's priorities and key insights. Please share your perspective based on your area of expertise.`;
                
                // Each agent responds with their own context
                for (let i = 0; i < agents.length; i++) {
                    const agent = agents[i];
                    showTypingIndicator();
                    await new Promise(resolve => setTimeout(resolve, 800)); // Brief delay between agents
                    
                    // Create personalized prompt for each agent
                    let agentPrompt = discussionContext;
                    
                    if (i === 0) {
                        // First agent starts the discussion
                        agentPrompt += ` You are ${agent.name}, ${agent.title}. Please begin the discussion by sharing the most critical insights from your perspective.`;
                    } else {
                        // Subsequent agents respond to previous agent(s)
                        const previousAgentNames = agents.slice(0, i).map(a => a.name).join(' and ');
                        agentPrompt += ` You are ${agent.name}, ${agent.title}. ${previousAgentNames} have already shared their insights. Please add your perspective and build upon what has been discussed.`;
                        
                        // Include summary of previous responses
                        if (discussionHistory.length > 0) {
                            const previousSummary = discussionHistory.map((h, idx) => 
                                `${agents[idx].name}: ${h.text.substring(0, 200)}...`
                            ).join('\n');
                            agentPrompt += `\n\nPrevious contributions:\n${previousSummary}`;
                        }
                    }
                    
                    // Send to agent with clean context
                    const response = await sendMessageToAgentDiscussion(agentPrompt, agent.id, i === 0 ? [] : discussionHistory);
                    
                    if (response) {
                        discussionHistory.push({ role: 'model', parts: [{ text: response }], agentId: agent.id });
                    }
                }
                
                // Add the discussion to main chat history as a summary
                const discussionSummary = `Agent Discussion Summary:\n${agents.map((a, i) => 
                    `${a.name}: ${discussionHistory[i]?.parts[0]?.text?.substring(0, 150) || 'No response'}...`
                ).join('\n\n')}`;
                
                chatHistory.push({ role: 'user', parts: [{ text: 'Please have the agents discuss key priorities' }] });
                chatHistory.push({ role: 'model', parts: [{ text: discussionSummary }] });
                
                // End discussion indicator
                const endIndicatorDiv = document.createElement('div');
                endIndicatorDiv.className = 'agent-discussion-indicator';
                endIndicatorDiv.textContent = '✓ Agent discussion completed';
                if (chatMessages) {
                    chatMessages.appendChild(endIndicatorDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
            }
            
            // New function for agent discussion with separate context
            async function sendMessageToAgentDiscussion(prompt, agentId, previousContext = [], retries = 3, delay = 1000) {
                const apiKey = "AIzaSyAJGvnZX6uuTlAnf_m0hCQFJ3knsJRnGIU";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

                const persona = personaData.find(p => p.id === agentId);
                let systemPromptText = persona ? persona.systemPrompt : 'You are a helpful assistant.';
                
                // Modify Layla's system prompt for discussions to avoid Chart.js conflicts
                if (agentId === 'layla') {
                    systemPromptText = 'You are Layla Al-Farsi, a Data Analytics Agent for HRSD in Saudi Arabia. In this discussion, provide data-driven insights and key analytical observations. Focus on strategic insights rather than detailed visualizations. Be concise and collaborative.';
                }
                
                // Simplify prompts for discussions
                systemPromptText += ' This is a collaborative discussion with other agents. Be concise (2-3 paragraphs maximum) and focus on your unique perspective.';

                // Build conversation history for this agent
                const conversationHistory = [
                    { role: 'user', parts: [{ text: prompt }] }
                ];

                const payload = {
                    contents: conversationHistory,
                    systemInstruction: {
                        parts: [{ text: `${systemPromptText} Your user is a high-level executive ("Your Highness"). The current date and time is ${new Date().toLocaleString('en-US', { timeZone: 'Asia/Riyadh' })}.` }]
                    },
                    generationConfig: {
                        maxOutputTokens: 1024, // Shorter for discussions
                        temperature: 0.8, // Slightly higher for variety
                    },
                    safetySettings: [
                        { category: 'HARM_CATEGORY_HARASSMENT', threshold: 'BLOCK_MEDIUM_AND_ABOVE' },
                        { category: 'HARM_CATEGORY_HATE_SPEECH', threshold: 'BLOCK_MEDIUM_AND_ABOVE' },
                        { category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT', threshold: 'BLOCK_MEDIUM_AND_ABOVE' },
                        { category: 'HARM_CATEGORY_DANGEROUS_CONTENT', threshold: 'BLOCK_MEDIUM_AND_ABOVE' },
                    ]
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    removeTypingIndicator();

                    if (!response.ok) {
                        if (!(response.status === 429 || response.status >= 500)) {
                           console.error(`API Error for ${agentId}:`, response.status, response.statusText);
                        }
                        if ((response.status === 429 || response.status >= 500) && retries > 0) {
                            await new Promise(resolve => setTimeout(resolve, delay));
                            return sendMessageToAgentDiscussion(prompt, agentId, previousContext, retries - 1, delay * 2);
                        }
                        throw new Error(`API error: ${response.status} ${response.statusText}`);
                    }

                    const result = await response.json();
                    const candidate = result.candidates?.[0];
                    const agentResponseText = candidate?.content?.parts?.[0]?.text;

                    if (agentResponseText) {
                        displayMessage('agent', agentResponseText, agentId);
                        return agentResponseText;
                    } else {
                        let errorText = `I apologize, but I couldn't contribute to the discussion at this time.`;
                        if (candidate && candidate.finishReason && candidate.finishReason !== 'STOP') {
                            console.warn(`${agentId} finishReason:`, candidate.finishReason);
                            errorText = `My response was blocked: ${candidate.finishReason.toLowerCase().replace(/_/g, ' ')}.`;
                        }
                        displayMessage('agent', errorText, agentId);
                        return null;
                    }
                } catch (error) {
                    console.error(`Error in discussion for ${agentId}:`, error.message);
                    removeTypingIndicator();
                    displayMessage('agent', "I'm having trouble connecting. Please try the discussion again.", agentId);
                    return null;
                }
            }


            // --- UI & Event Listeners ---
            function updateTodaysAgendaPanel() {
                 if (!summaryContent) return;
                const now = today;
                const todayStr = now.toISOString().split('T')[0];
                const allEvents = Array.from(document.querySelectorAll('.event'));
                const todaysEvents = allEvents.filter(eventEl => eventEl.dataset.date === todayStr);
                const upcomingEvents = todaysEvents.filter(eventEl => { /* ... time filtering logic ... */
                    const eventTimeStr = eventEl.dataset.eventTime; let eventHour = 99; let eventMinute = 0;
                    if (eventTimeStr === 'EOD') { eventHour = 17; } else if (eventTimeStr.includes(':')) { const parts = eventTimeStr.match(/(\d+):(\d+)\s*(AM|PM)?/i); if (parts) { eventHour = parseInt(parts[1]); eventMinute = parseInt(parts[2]); const isPM = parts[3] && parts[3].toUpperCase() === 'PM'; if (isPM && eventHour !== 12) eventHour += 12; if (!isPM && eventHour === 12) eventHour = 0; } }
                    return now.getHours() < eventHour || (now.getHours() === eventHour && now.getMinutes() < eventMinute);
                });
                upcomingEvents.sort((a, b) => { /* ... time sorting logic ... */
                    const timeStrToMinutes = (timeStr) => { if (timeStr === 'EOD') return 17 * 60; const parts = timeStr.match(/(\d+):(\d+)\s*(AM|PM)?/i); if (parts) { let hours = parseInt(parts[1]); const minutes = parseInt(parts[2]); const isPM = parts[3] && parts[3].toUpperCase() === 'PM'; if (isPM && hours !== 12) hours += 12; if (!isPM && hours === 12) hours = 0; return hours * 60 + minutes; } return 24 * 60; }; return timeStrToMinutes(a.dataset.eventTime) - timeStrToMinutes(b.dataset.eventTime);
                });

                if (upcomingEvents.length > 0) { /* ... populate with next/later events ... */
                    const nextEvent = upcomingEvents[0]; const laterEvents = upcomingEvents.slice(1);
                    summaryContent.innerHTML = `<h4>Next Up: ${nextEvent.dataset.eventTitle} (${nextEvent.dataset.eventTime})</h4> <p>${nextEvent.dataset.eventDetails}</p> <div class="key-topics-pills"><div class="key-topic-pill" data-topic="Key Objectives">Key Objectives</div><div class="key-topic-pill" data-topic="Attendees">Attendees</div><div class="key-topic-pill" data-topic="Required Actions">Required Actions</div></div>`;
                    if (laterEvents.length > 0) { summaryContent.innerHTML += '<h4>Later Today</h4><ul>'; laterEvents.forEach(eventEl => { summaryContent.innerHTML += `<li><strong>${eventEl.dataset.eventTitle}</strong> (${eventEl.dataset.eventTime})</li>`; }); summaryContent.innerHTML += '</ul>'; }
                    summaryContent.querySelectorAll('.key-topic-pill').forEach(pill => { pill.addEventListener('click', () => { const prompt = `Elaborate on the topic "${pill.dataset.topic}" regarding the "${nextEvent.dataset.eventTitle}".`; switchToAgentAndSendPrompt(prompt); }); });
                } else { /* ... show completed / look ahead ... */
                     summaryContent.innerHTML = `<h4>Today's Agenda</h4><p>No further meetings or milestones scheduled for today.</p>`;
                    const tomorrow = new Date(now); tomorrow.setDate(now.getDate() + 1); const tomorrowStr = tomorrow.toISOString().split('T')[0]; const tomorrowsEvents = allEvents.filter(eventEl => eventEl.dataset.date === tomorrowStr); tomorrowsEvents.sort((a, b) => { /* Add sorting if needed */ });
                    if (tomorrowsEvents.length > 0) { summaryContent.innerHTML += `<h4>Tomorrow's First Item: ${tomorrowsEvents[0].dataset.eventTitle} (${tomorrowsEvents[0].dataset.eventTime})</h4>`; }
                }
            }


            function setViewportHeight() {
                let vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            }

             // Calendar Toggle Button Logic
            function setupCalendarToggles() {
                document.querySelectorAll('.view-toggle').forEach(toggle => {
                    toggle.addEventListener('click', e => {
                        const button = e.target.closest('[data-view]');
                        if (!button) return;
                        const view = button.dataset.view;
                        const calendarContainer = button.closest('.desktop-calendar, .mobile-calendar');
                        if (!calendarContainer) return;
                        calendarContainer.querySelectorAll('[data-view]').forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        if (calendarContainer.classList.contains('desktop-calendar')) {
                            calendarContainer.querySelectorAll('.agenda-view').forEach(v => v.classList.remove('active'));
                            const targetView = calendarContainer.querySelector(`#${view}-view`);
                            if (targetView) targetView.classList.add('active');
                            if (view === 'month') { renderDesktopMonthCalendar(); }
                            if (view === 'today') { renderTodayView(); }
                        }
                    });
                });
            }


            // Desktop Month Calendar Rendering
            function renderDesktopMonthCalendar() {
                 const monthGrid = document.getElementById('month-calendar-grid');
                if (!monthGrid) return;
                const allEvents = Array.from(document.querySelectorAll('.event[data-date]'));
                const eventsByDate = new Map();
                allEvents.forEach(e => { const date = e.dataset.date; if (!eventsByDate.has(date)) { eventsByDate.set(date, []); } eventsByDate.get(date).push(e); });
                const year = today.getFullYear(); const month = today.getMonth();
                const todayDateOnly = new Date(year, month, today.getDate());
                const firstDayOfMonth = new Date(year, month, 1); const daysInMonth = new Date(year, month + 1, 0).getDate(); const startingDay = firstDayOfMonth.getDay();
                monthGrid.innerHTML = '';
                ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach((day, index) => { const isWeekend = index === 5 || index === 6; monthGrid.innerHTML += `<div class="month-day-header ${isWeekend ? 'weekend' : ''}">${day}</div>`; });
                for (let i = 0; i < startingDay; i++) { monthGrid.innerHTML += '<div class="month-day-cell other-month"></div>'; }
                for (let day = 1; day <= daysInMonth; day++) { const date = new Date(year, month, day); const dayOfWeek = date.getDay(); const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`; const isToday = day === today.getDate(); const isPast = date < todayDateOnly; const isWeekend = dayOfWeek === 5 || dayOfWeek === 6; let cellClasses = 'month-day-cell'; if (isToday) cellClasses += ' today'; if (isPast) cellClasses += ' disabled-day'; if (isWeekend) cellClasses += ' weekend'; let cellHtml = `<div class="${cellClasses}" data-date="${dateStr}"><div class="month-day-number">${day}</div><div class="month-day-events">`; if (eventsByDate.has(dateStr)) { eventsByDate.get(dateStr).forEach(eventEl => { const isMilestone = eventEl.classList.contains('event-milestone'); cellHtml += `<div class="month-event-dot ${isMilestone ? 'milestone' : ''}"></div>`; }); } cellHtml += `</div></div>`; monthGrid.innerHTML += cellHtml; }
                 monthGrid.querySelectorAll('.month-day-cell:not(.disabled-day, .other-month)').forEach(cell => { const dateStr = cell.dataset.date; cell.addEventListener('click', () => { if (eventsByDate.has(dateStr)) { const firstEvent = eventsByDate.get(dateStr)[0]; openEventModal(firstEvent.dataset.eventTitle, firstEvent.dataset.eventTime, firstEvent.dataset.eventDetails); } else { openDayActionModal(dateStr); } }); });
            }

            // Day Action Modal
            function openDayActionModal(dateStr) {
                 const date = new Date(dateStr + 'T00:00:00'); const titleEl = document.getElementById('day-action-title'); const pillsContainer = document.getElementById('day-action-pills'); const actionsContainer = document.querySelector('#dayActionModal .day-actions'); if (!titleEl || !pillsContainer || !actionsContainer) return;
                titleEl.textContent = `Actions for ${date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}`; pillsContainer.innerHTML = ''; document.querySelectorAll('.topic-card .topic-title').forEach(titleElement => { const pill = document.createElement('div'); pill.className = 'modal-topic-pill'; pill.textContent = titleElement.textContent; pill.dataset.topic = titleElement.textContent; pillsContainer.appendChild(pill); }); let selectedTopic = ''; pillsContainer.querySelectorAll('.modal-topic-pill').forEach(pill => { pill.addEventListener('click', () => { pillsContainer.querySelectorAll('.modal-topic-pill').forEach(p => p.classList.remove('active')); pill.classList.add('active'); selectedTopic = pill.dataset.topic; }); }); const newActionsContainer = actionsContainer.cloneNode(true); actionsContainer.parentNode.replaceChild(newActionsContainer, actionsContainer); newActionsContainer.querySelectorAll('button').forEach(button => { button.addEventListener('click', () => { if (!selectedTopic) { showMessageModal("Please select a focus area first."); return; } const action = button.dataset.action; let prompt = ''; const formattedDate = date.toLocaleDateString('en-US', { month: 'long', day: 'numeric' }); switch(action) { case 'check': prompt = `Draft an email to check stakeholders' availability for a meeting on ${formattedDate} regarding "${selectedTopic}".`; break; case 'media': prompt = `Draft an email to the media team to coordinate potential media coverage for an initiative related to "${selectedTopic}" around ${formattedDate}.`; break; case 'consulting': prompt = `Draft an email to summon the consulting team for a high-priority meeting on ${formattedDate} to discuss "${selectedTopic}". Emphasize urgency.`; break; } if(prompt) { switchToAgentAndSendPrompt(prompt); } }); }); openModal(dayActionModal);
            }

            // Desktop Today View Rendering
            function renderTodayView() {
                 const todayList = document.getElementById('today-events-list'); const todayDateEl = document.querySelector('#today-view .today-date'); if (!todayList || !todayDateEl) return;
                const todayStr = today.toISOString().split('T')[0]; todayDateEl.textContent = today.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }); const todaysEvents = Array.from(document.querySelectorAll(`.event[data-date="${todayStr}"]`)); todayList.innerHTML = ''; if (todaysEvents.length > 0) { todaysEvents.forEach(eventEl => { const eventClone = eventEl.cloneNode(true); eventClone.addEventListener('click', () => { openEventModal(eventClone.dataset.eventTitle, eventClone.dataset.eventTime, eventClone.dataset.eventDetails); }); todayList.appendChild(eventClone); }); } else { todayList.innerHTML = '<p style="opacity: 0.7; text-align: center; padding: 20px;">No events scheduled for today.</p>'; }
            }

            // Mobile Calendar Logic
            function initMobileCalendar() {
                 const monthGrid = document.getElementById('mobile-month-grid'); const agendaEvents = document.getElementById('mobile-agenda-events'); if (!monthGrid || !agendaEvents) return;
                const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']; let selectedDate = today; const allEvents = Array.from(document.querySelectorAll('.event[data-date]')); const eventDates = new Set(allEvents.map(e => e.dataset.date));
                function renderCalendar() { monthGrid.innerHTML = ''; dayNames.forEach(day => { const dayNameEl = document.createElement('div'); dayNameEl.className = 'day-name'; dayNameEl.textContent = day; monthGrid.appendChild(dayNameEl); }); for (let day = 19; day <= 25; day++) { const dayCell = document.createElement('div'); dayCell.className = 'day-cell'; dayCell.textContent = day; const currentDayDate = new Date(today.getFullYear(), today.getMonth(), day); const dateStr = currentDayDate.toISOString().split('T')[0]; if (day === today.getDate()) { dayCell.classList.add('today'); } if (dateStr === selectedDate.toISOString().split('T')[0]) { dayCell.classList.add('selected'); } if (eventDates.has(dateStr)) { dayCell.classList.add('has-event'); } dayCell.addEventListener('click', () => { selectedDate = currentDayDate; renderCalendar(); renderEvents(dateStr); }); monthGrid.appendChild(dayCell); } }
                function renderEvents(dateStr) { const dayEvents = allEvents.filter(e => e.dataset.date === dateStr); if (dayEvents.length === 0) { agendaEvents.innerHTML = '<p style="opacity: 0.7; text-align: center; padding: 20px;">No events scheduled for this day</p>'; return; } agendaEvents.innerHTML = ''; dayEvents.forEach(eventEl => { const eventDiv = document.createElement('div'); eventDiv.className = 'event'; if (eventEl.classList.contains('event-milestone')) { eventDiv.classList.add('event-milestone'); } eventDiv.innerHTML = `<div class="event-time">${eventEl.dataset.eventTime}</div> <div class="event-title">${eventEl.dataset.eventTitle}</div>`; eventDiv.addEventListener('click', () => { openEventModal(eventEl.dataset.eventTitle, eventEl.dataset.eventTime, eventEl.dataset.eventDetails); }); agendaEvents.appendChild(eventDiv); }); }
                renderCalendar(); renderEvents(selectedDate.toISOString().split('T')[0]);
            }

            // --- Event Listeners & Initialization ---

            // Modal close buttons
            closeModalBtns.forEach(btn => { btn.addEventListener('click', () => { const modal = btn.closest('.modal'); if (modal) closeModal(modal); }); });
            window.addEventListener('click', (event) => { if (event.target.classList.contains('modal')) { closeModal(event.target); } });
            // Copy summary button
            if (copySummaryBtn) { copySummaryBtn.addEventListener('click', () => { const contentToCopy = summaryContent ? summaryContent.innerText : ''; if (contentToCopy) { const textArea = document.createElement("textarea"); textArea.value = contentToCopy; textArea.style.position = "fixed"; textArea.style.left = "-9999px"; document.body.appendChild(textArea); textArea.focus(); textArea.select(); try { document.execCommand('copy'); showMessageModal('Agenda copied to clipboard!'); } catch (err) { console.error('Fallback copy failed', err); showMessageModal('Copying failed.'); } document.body.removeChild(textArea); } else { showMessageModal('Nothing to copy.'); } }); }
            // Persona change button
            if (changePersonaBtn) { changePersonaBtn.addEventListener('click', () => openModal(personaModal)); }
            // Send button and Enter key
            if (sendBtn) { sendBtn.addEventListener('click', handleSendMessage); }
            if (chatInput) { chatInput.addEventListener('keydown', (event) => { if (event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); handleSendMessage(); } }); }
            // Topic card actions
            document.querySelectorAll('.topic-action-btn').forEach(button => { button.addEventListener('click', () => { const action = button.dataset.action; const card = button.closest('.topic-card'); if (!card) return; const topicId = card.dataset.topicId; const topicTitleEl = card.querySelector('.topic-title'); if (!topicTitleEl) return; const topicTitle = topicTitleEl.textContent; if (action === 'meetings') { openMeetingsModal(topicId, topicTitle); } else if (action === 'deeper') { const prompt = `Can you dig deeper into the topic of "${topicTitle}" for me? Provide key details and current status.`; takeActionFromTopic(prompt); } else if (action === 'references') { const prompt = `Please pull up the latest references and documents from my team regarding "${topicTitle}".`; takeActionFromTopic(prompt); } }); });
            // "Ask Agent" on text selection
             document.addEventListener('mouseup', (e) => { if (!askAgentBtn) return; const targetElement = e.target; if (targetElement.tagName === 'INPUT' || targetElement.tagName === 'TEXTAREA' || targetElement.closest('.modal') || targetElement.closest('#ask-agent-btn')) { askAgentBtn.style.display = 'none'; return; } setTimeout(() => { const text = window.getSelection().toString().trim(); if (text.length > 1) { selectedText = text; const rect = window.getSelection().getRangeAt(0).getBoundingClientRect(); askAgentBtn.style.left = `${rect.right + window.scrollX + 5}px`; askAgentBtn.style.top = `${rect.bottom + window.scrollY + 5}px`; askAgentBtn.style.display = 'block'; } else { askAgentBtn.style.display = 'none'; } }, 10); });
            document.addEventListener('mousedown', (e) => { if (askAgentBtn && e.target.id !== 'ask-agent-btn') { askAgentBtn.style.display = 'none'; } });
            if (askAgentBtn) { askAgentBtn.addEventListener('click', (e) => { e.stopPropagation(); if (selectedText) { const prompt = `Please provide more details about the following text I selected: "${selectedText}"`; switchToAgentAndSendPrompt(prompt); selectedText = ''; } askAgentBtn.style.display = 'none'; }); }
            // Mobile menu toggle
            if (mobileMenuBtn) { mobileMenuBtn.addEventListener('click', () => { if (navTabsContainer) navTabsContainer.classList.toggle('active'); }); }
            // Quick Actions
            document.querySelectorAll('.quick-action-btn').forEach(btn => { btn.addEventListener('click', () => { const action = btn.dataset.action; let prompt = ''; switch(action) { case 'call': showMessageModal("Voice call feature not implemented in this demo."); return; case 'agenda': prompt = "Please provide a detailed overview of my agenda for today, including all scheduled meetings and key tasks."; break; } if (prompt && chatInput) { chatInput.value = prompt; handleSendMessage(); } }); });
            // Chat "+" Action Button
             chatActionBtn?.addEventListener('click', (e) => { e.stopPropagation(); const list = document.getElementById('meetings-modal-list'); const title = document.getElementById('meetings-modal-title'); if (!list || !title) { console.error("Meetings modal elements not found"); return; } openModal(meetingsModal); list.innerHTML = ''; title.textContent = `Discuss a Topic`; let content = '<div class="dropdown-header">Discuss a Focus Area</div><div class="modal-pills-container">'; document.querySelectorAll('.topic-card .topic-title').forEach(titleEl => { content += `<div class="modal-topic-pill chat-action-item" data-prompt="Let's discuss the focus area: ${titleEl.textContent}">${titleEl.textContent}</div>`; }); content += '</div>'; content += '<div class="dropdown-header">Discuss a Meeting</div>'; const events = document.querySelectorAll('.event[data-date]'); if (events.length > 0) { events.forEach(event => { const eventTitle = event.dataset.eventTitle || 'Unnamed Meeting'; const eventTime = event.dataset.eventTime || 'No time'; const eventDateStr = event.dataset.date; if(eventDateStr) { const eventDate = new Date(eventDateStr + 'T00:00:00').toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }); content += `<div class="meeting-item chat-action-item" data-prompt="What should I know about the meeting: ${eventTitle}?"><div class="meeting-title">${eventTitle}</div><div class="meeting-time">${eventDate} - ${eventTime}</div></div>`; } }); } else { content += '<p>No meetings found.</p>'; } list.innerHTML = content; list.querySelectorAll('.chat-action-item').forEach(item => { item.addEventListener('click', (ev) => { ev.preventDefault(); if (chatInput && item.dataset.prompt) { chatInput.value = item.dataset.prompt; handleSendMessage(); } closeModal(meetingsModal); }); }); });

             // --- Updated Tool Card Actions ---
             document.querySelectorAll('.tool-action-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const action = button.dataset.toolAction;
                    const card = button.closest('.tool-card');
                    if (!card) return;
                    const toolTitleEl = card.querySelector('.tool-title');
                    if (!toolTitleEl) return;
                    const toolTitle = toolTitleEl.textContent;

                    let targetPersonaId = 'hakim'; // Default
                    let prompt = `Tell me more about how I can use the "${toolTitle}" AI tool.`;

                    // Assign persona and craft prompt based on the tool action
                    switch(action) {
                        case 'visualize':
                        case 'predict':
                        case 'sentiment':
                            targetPersonaId = 'layla'; // Data Analyst
                            prompt = `Please assist me with ${toolTitle}. What data do you need to get started?`;
                            break;
                        case 'summarize':
                            targetPersonaId = 'hakim'; // Executive Agent
                            prompt = `I need help using the ${toolTitle} tool. Can you guide me or perform a summarization task?`;
                            break;
                        case 'schedule':
                            targetPersonaId = 'omar'; // Coordinator
                            prompt = `I need to schedule a meeting using the ${toolTitle}. Please help me coordinate.`;
                            break;
                        case 'risk':
                            targetPersonaId = 'hakim'; // Executive Agent (strategic risk)
                            // Or potentially Layla if focused on data-driven risk: targetPersonaId = 'layla';
                            prompt = `I need to use the ${toolTitle} tool. Can you help me assess risks related to [Specify Area/Project]?`;
                            break;
                        default:
                             prompt = `Tell me more about the "${toolTitle}" tool.`;
                    }

                    // Switch persona (if needed) and send the prompt
                    switchToAgentAndSendPrompt(prompt, targetPersonaId);
                });
            });


             // --- Corrected Navigation Logic ---
             if (navButtons && pages) {
                 navButtons.forEach(button => {
                     button.addEventListener('click', () => {
                         const targetId = button.dataset.target;
                         const targetPage = document.getElementById(targetId);

                         // Hide all pages first
                         pages.forEach(page => {
                             if (page) page.classList.remove('active');
                         });

                         // Show the target page if found
                         if (targetPage) {
                             targetPage.classList.add('active');
                         } else {
                             console.error(`Target page with ID "${targetId}" not found.`);
                         }

                         // Update button active state
                         navButtons.forEach(btn => btn.classList.remove('active'));
                         button.classList.add('active');

                         // Close mobile nav if open
                         if (navTabsContainer && navTabsContainer.classList.contains('active')) {
                             navTabsContainer.classList.remove('active');
                         }
                     });
                 });
             } else {
                 console.error("Navigation buttons or page content elements not found.");
             }

            // --- INITIALIZATION ---
            setViewportHeight();
            setupCalendarToggles(); // Should be defined before call now
            updatePersonaUI(currentPersonaId, true);
            updateTodaysAgendaPanel();
            setupAgendaInteractions();
            initMobileCalendar();
            renderDesktopMonthCalendar();
            renderTodayView();
            
            // Initialize UI based on mode (start in single agent mode)
            toggleMode(false);
            renderAgentSelection();
            updateSingleAgentDisplay(currentPersonaId);
            
            // Mode Toggle
            const modeToggle = document.getElementById('modeToggle');
            if (modeToggle) {
                modeToggle.addEventListener('change', (e) => {
                    toggleMode(e.target.checked);
                });
            }
            
            // Agent Selector Button (for single mode)
            const agentSelectorBtn = document.getElementById('agentSelectorBtn');
            if (agentSelectorBtn) {
                agentSelectorBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showAgentSelectorMenu();
                });
            }
            
            // Agent Discussion button
            const agentDiscussBtn = document.getElementById('agentDiscussBtn');
            if (agentDiscussBtn) {
                agentDiscussBtn.addEventListener('click', startAgentDiscussion);
            }
            
            // Mobile agent selector expand/collapse
            const personaDisplay = document.querySelector('.persona-display');
            const multiAgentHeader = document.querySelector('.multi-agent-header');
            if (personaDisplay && multiAgentHeader && window.innerWidth <= 768) {
                multiAgentHeader.addEventListener('click', () => {
                    personaDisplay.classList.toggle('expanded');
                });
            }

        });
    </script>



</body></html>
